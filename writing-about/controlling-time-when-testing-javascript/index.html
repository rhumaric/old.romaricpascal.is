<!doctype html><html lang="en-US"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .u-troisCoups body>* {
            visibility: hidden;
        }
    </style>
    <script>
        (function (window) {
            if (document.documentElement.classList) {
                window.troisCoups = {
                    reveal: function () {
                        document.documentElement.classList.remove('u-troisCoups');
                    }
                };


                document.documentElement.classList.add('u-troisCoups');
                setTimeout(window.troisCoups.reveal, 1500);
            }
        })(window);
    </script>

    <link rel="stylesheet" href="/wp-content/themes/romaricpascal.is/style.css">
    <link rel="alternate" type="application/rss+xml" title="Romaric Pascal | Lettering &#x26; web development" href="/feed">

    <title>   Controlling time when testing Javascript | Romaric Pascal</title>
    <meta name="description" content="Lettering &#x26; web development">

    <link rel="apple-touch-icon" sizes="180x180" href="/wp-content/themes/romaricpascal.is/assets/images/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/wp-content/themes/romaricpascal.is/assets/images/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/wp-content/themes/romaricpascal.is/assets/images/favicons/favicon-16x16.png">
<link rel="manifest" href="/wp-content/themes/romaricpascal.is/assets/images/favicons/manifest.json">
<link rel="mask-icon" href="/wp-content/themes/romaricpascal.is/assets/images/favicons/safari-pinned-tab.svg" color="#022950">
<link rel="shortcut icon" href="/wp-content/themes/romaricpascal.is/assets/images/favicons/favicon.ico">
<meta name="msapplication-config" content="/wp-content/themes/romaricpascal.is/assets/images/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffc744">
    <!-- FB OpenGraph info -->
        <meta prefix="og:http://ogp.me/ns#" property="og:url" content="/writing-about/controlling-time-when-testing-javascript/">
        <meta prefix="og:http://ogp.me/ns#" property="og:title" content="   Controlling time when testing Javascript | Romaric Pascal">
    <meta prefix="og:http://ogp.me/ns#" property="og:description" content="Lettering &#x26; web development">
    <meta prefix="og:http://ogp.me/ns#" property="og:image" content="/wp-content/themes/romaricpascal.is/assets/images/rp_with-padding_yellowbg_480.png">

    <!-- Twitter cards -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@romaricpascal">
    <meta name="twitter:title" content="   Controlling time when testing Javascript | Romaric Pascal">
    <meta name="twitter:description" content="Lettering &#x26; web development">
    <meta name="twitter:image" content="/wp-content/themes/romaricpascal.is/assets/images/rp_with-padding_yellowbg_480.png">

    <link rel="dns-prefetch" href="//s.w.org">
<link rel="alternate" type="application/rss+xml" title="Romaric Pascal » Controlling time when testing Javascript Comments Feed" href="/writing-about/controlling-time-when-testing-javascript/feed/">
		
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>



<link rel="canonical" href="/writing-about/controlling-time-when-testing-javascript/">
  </head>
  <body class="post-template-default single single-post postid-372 single-format-standard flexbug3Wrapper">
    <header id="#header" class="rp-Header">
        <a class="rp-Logo" href="" title="Home">
    <img src="/wp-content/themes/romaricpascal.is/assets/images/rp-letters_144.png" alt="R-P monogram">
</a>
<nav class="rp-BreadcrumbNav">
    <div class="rp-CollapsedItemsMenu">
        <a class="rp-BreadcrumbLink rp-CollapsedItemsMenuToggle js-toggle" data-toggle-group="overlays" data-toggle-target=".rp-CollapsedItems">
            <span class="rp-BreadcrumbLinkSeparator"></span>
            <span class="rp-BreadcrumbLink__title">...</span>
        </a>
        <div class="rp-CollapsedItems js-outsideToggle"></div>
    </div>
    <div class="rp-BreadcrumbNavItems js-collapsible">
				<a href="/writing-about/" class="rp-BreadcrumbLink">
			<span class="rp-BreadcrumbLinkSeparator"></span>
			<span class="rp-BreadcrumbLink__title">Posts</span>
		</a>
		    </div>
</nav>      <nav class="rp-MainNav">
        <a class="t-hidden-visually" tabindex="1" href="#content">Skip to content</a>
        <a href="#main-nav" class="js-toggle" data-toggle-group="overlays" data-toggle-target=".rp-MenuContainer">Menu</a>
        <div class="rp-MenuContainer js-outsideToggle" id="main-nav">
        <a class="rp-NavLogo" href="" title="Home">
            <img src="/wp-content/themes/romaricpascal.is/assets/images/rp-knockout_shade_144.png" alt="Home">
        </a>
        <div class="menu-site-navigation-container"><ul id="menu-site-navigation" class="rp-Menu rp-Header__menuI"><li id="menu-item-936" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home menu-item-936"><a href="/">Home</a></li>
<li id="menu-item-960" class="menu-item menu-item-type-post_type_archive menu-item-object-project menu-item-has-children menu-item-960"><a href="/proud-of/">Portfolio</a>
<ul class="sub-menu">
	<li id="menu-item-942" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-942"><a href="/proud-of/logo-brand-designs">Logo &#x26; Brand</a></li>
	<li id="menu-item-954" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-954"><a href="/proud-of/tshirts-merch-designs/">T-shirts &#x26; merch</a></li>
	<li id="menu-item-957" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-957"><a href="/proud-of/print-illustration-designs">Print &#x26; illustration</a></li>
</ul>
</li>
<li id="menu-item-964" class="menu-item menu-item-type-post_type_archive menu-item-object-artwork menu-item-964"><a href="/drawing-letters/">Artworks</a></li>
<li id="menu-item-935" class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-935"><a href="/writing-about/">Blog</a></li>
<li id="menu-item-933" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-933"><a href="/happy-to-chat/">Contact</a></li>
<li id="menu-item-1022" class="menu-item menu-item-type-taxonomy menu-item-object-craft current-post-ancestor current-menu-parent current-post-parent menu-item-1022"><a href="/writing-about/craft/web/">Web</a></li>
<li id="menu-item-934" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-934"><a target="_blank" href="/selling-nice-stuff/">Shop</a></li>
</ul></div>        <a class="rp-MenuToggle js-toggle" href="#" data-toggle-group="overlays" data-toggle-target=".rp-MenuContainer">Close menu</a>
        <small class="rp-Legal l-Container">© Romaric Pascal (trading name of <a href="https://beta.companieshouse.gov.uk/company/08544032">Rhumaric Ltd</a>)</small>
        </div>
      </nav>
    </header>
    <div class="rp-Viewport l-vertCentered u-mh-100vh">


<article class="rp-Content">
  <header class="rp-HeaderWithSubhead u-mb-2">
    <h1 class="rp-HeaderWithSubhead__heading">
        Controlling time when testing Javascript    </h1>
    <p><time datetime="2013-11-19T12:20:54+00:00">19 Nov 2013</time> — An article about: <a href="/writing-about/craft/web/" rel="tag">Web</a> - <a href="/writing-about/category/uncategorized/" rel="category tag">Uncategorized</a></p>
  </header>
  <main>
    <p>Say you're writing some cool stuff in Javascript. You've got some automated tests, it makes sure the features work OK. But there's that feature relying on <code>setTimeout</code> and this other one relying on <code>setInterval</code>. Sure your testing framework handles asynchronous tests. But you'd like to avoid having slow tests because you have to wait X milliseconds for a timeout to clear. That's when Sinon.JS 'clock' (or fake timers) feature comes in and saves the day.</p>
<p>Sinon is a mocking Javascript library (both for Node and browsers). It allows you to create fake functions (or objects) to help checking that "this function's being called" or "this function got passed this argument". But mocking probably deserves its own article so I won't expand on it, as time is of the essence here.</p>
<p>ack to controlling time, then… It's done with the help of <code>sinon.useFakeTimers()</code> method. This will replace the implementation of <code>setTimeout()</code> and <code>setInterval()</code> so they're tied to a clock you programatically control rather than actual milliseconds. </p>
<p>You'd usually do the replacement during the test setup. Then, inside your tests, you'd use the clock's <code>tick()</code> method to move the time forward. And once you're finished, of course, you'd restore the original implementations so that other tests are not impacted. Which would result in something like:</p>
<div class="highlight">
<pre><span class="nx">describe</span><span class="p">(</span><span class="s1">'MinutesCounter'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

  <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">clock</span> <span class="o">=</span> <span class="nx">sinon</span><span class="p">.</span><span class="nx">useFakeTimers</span><span class="p">();</span>
  <span class="p">});</span>

  <span class="nx">afterEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">clock</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="s1">'Should be incremented once a minute has elapsed'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">counter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MinuteCounter</span><span class="p">();</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">counter</span><span class="p">.</span><span class="nx">count</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">clock</span><span class="p">.</span><span class="nx">tick</span><span class="p">(</span><span class="mi">60000</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">counter</span><span class="p">.</span><span class="nx">count</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre>
</div>
<p>The 60 seconds it would have taken to run the test without Sinon now go by instantly. The test is faster and won't leave you waiting (too long) everytime you run it.</p>
<p>Not being tied to real seconds also makes the test cleaner. There's no longer need for it to be asynchronous and use <code>setTimeout</code> to run the assertions only after the minute has elapsed.</p>
<p>Sinon really helps when testing features relying on <code>setTimeout()</code> or <code>setInterval()</code>. It makes tests faster and cleaner. Definitely a valuable addition to my testing toolbelt.</p>
  </main>
  <aside>

  </aside>
  <nav class="rp-PrevNextNav">
		<a class="rp-PrevNextLink rp-PrevNextLink-prev rp-PrevNextNav__previous" href="/writing-about/introducing-grunt-githooks/" rel="prev" accesskey="j" data-key="left" title="Introducing grunt-githooks">
	   	title	</a>
		<a class="rp-PrevNextLink rp-PrevNextLink-next rp-PrevNextNav__next" href="/writing-about/testing-your-javascript-ui-with-simulated-events/" rel="next" accesskey="k" data-key="right" title="Testing your Javascript UI with simulated events">
	   	title	</a>
</nav>
</article>

  </div>
  

  <script defer src="/wp-content/themes/romaricpascal.is/main.js"></script>

</body></html>