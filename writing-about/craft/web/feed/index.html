<!--?xml version="1.0" encoding="UTF-8"?--><html><head></head><body><rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:wfw="http://wellformedweb.org/CommentAPI/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:sy="http://purl.org/rss/1.0/modules/syndication/" xmlns:slash="http://purl.org/rss/1.0/modules/slash/">

<channel>
	<title>Web ‚Äì Romaric Pascal</title>
	<atom:link href="/writing-about/craft/web/feed/" rel="self" type="application/rss+xml">
	<link>
	<description>Lettering &#x26; web development</description>
	<lastbuilddate>Thu, 13 Feb 2020 11:35:45 +0000</lastbuilddate>
	<language>en-US</language>
	<sy:updateperiod>hourly</sy:updateperiod>
	<sy:updatefrequency>1</sy:updatefrequency>
	<generator>https://wordpress.org/?v=4.8.13</generator>
	<item>
		<title>Composing animations through functions</title>
		<link>/writing-about/composing-animations-through-functions/
		<pubdate>Fri, 27 Oct 2017 19:37:02 +0000</pubdate>
		<dc:creator><!--[CDATA[romaricpascal]]--></dc:creator>
				<category><!--[CDATA[Animations]]--></category>
		<category><!--[CDATA[JS]]--></category>
		<description><!--[CDATA[<p-->In <a href="/writing-about/animations-with-javascript-functions/">the introduction of this venture into animations</a> and functions, the animation was simply fading in one element (linearly). Enough for an example, but not really fitting if we talk animating multiple elements, or multiple properties.<p></p>
<p>We‚Äôd want to run multiple animations at the same time, maybe with specific timings, perhaps also control how the progress flows (easing, revert‚Ä¶). </p>
<p>Focus on the animation functions rather than the sources.</p>
<p>Let‚Äôs see how we can express that with little functions to compose into a bigger animation.</p>
<h2 id="controlling-progress"><a name="user-content-controlling-progress" href="#controlling-progress" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Controlling progress</h2>
<p>Progress, with a time source at least, flows linearly. It‚Äôs simple, but doesn‚Äôt give the animation a natural feel. In the real world, objects don‚Äôt start moving at their cruise speed straight away. If they ever move at a constant speed anyway. And equally, they don‚Äôt stop instantly once they‚Äôve finished moving.</p>
<p>To mimic that in animations, we need something to alter how progress‚Ä¶ well‚Ä¶ progresses. That‚Äôs the role of easing functions. This is not only important for things to look natural, but easings also allow to play on the feelings conveyed by the animation: make something hurry out of the screen, or instead enter with a sluggish, heavy feel.</p>
<p>Easing functions have been around for a while, the most used being the list by Robert Penner, though you can define custom bezier curves or even use spring physics. So let‚Äôs focus on how we can use them with our animation. For that, we can write a wrapper function that will apply the easing before delegating the rest to the animation.</p>
<figure>
    <script src="https://gist.github.com/rhumaric/7921124960e3a48511315c3f123c2626.js?file=easing.js"></script><br>
</figure>
<p>And with that, we can control how progress flows. On the same principle, we can write a function that will revert the animations.</p>
<figure>
<script src="https://gist.github.com/rhumaric/7921124960e3a48511315c3f123c2626.js?file=revert.js"></script><p></p>
<div class="o-ratio o-ratio--16:9">
    <iframe src="/wp-content/uploads/demo/animation-with-functions/composing-animations/progress/">&#x26;#x26;#x3C;br />
    &#x26;#x26;#x3C;a href="/wp-content/uploads/demo/animation-with-functions/composing-animations/progress/">See the demo&#x26;#x26;#x3C;/a>&#x26;#x26;#x3C;br />
</iframe>
</div><figcaption class="u-ta-c" style="padding: 0.5em;">Click the dots to run the animation.<br>Notice how the second dot accelerates and decelerates more naturally.</figcaption></figure>
<p>These two simple examples show the general pattern we‚Äôll be applying for the rest of the article and go towards coordinating the animation of multiple elements.</p>
<h2 id="multiple-animations"><a name="user-content-multiple-animations" href="#multiple-animations" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Multiple animations</h2>
<p>So far, we‚Äôre still stuck with running just one animation at a time. To animate the 3 dots, we need 3 sources of times.</p>
<figure>
    <script src="https://gist.github.com/rhumaric/7921124960e3a48511315c3f123c2626.js?file=time-sources.js"></script><br>
</figure>
<p>It works, but if we could run it with only one source of time, it would make things a bit more reusable. With the same pattern as before (creating a new function that wraps the various animations we want to play) we can write this little function for playing them all in one go:</p>
<figure>
    <script src="https://gist.github.com/rhumaric/7921124960e3a48511315c3f123c2626.js?file=parallel.js"></script><p></p>
<div class="o-ratio o-ratio--16:9">
    <iframe src="/wp-content/uploads/demo/animation-with-functions/composing-animations/parallel/">&#x26;#x26;#x3C;br />
    &#x26;#x26;#x3C;a href="/wp-content/uploads/demo/animation-with-functions/composing-animations/parallel/">See the demo&#x26;#x26;#x3C;/a>&#x26;#x26;#x3C;br />
</iframe>
</div><figcaption class="u-ta-c" style="padding: 0.5em;">Click the dots to run the animation.</figcaption></figure>
<p>There we go! We can now play several animations from the same source of progress. One little issue though, they all run for the full duration. Let‚Äôs see how we can tackle that.</p>
<h2 id="shifting-timings"><a name="user-content-shifting-timings" href="#shifting-timings" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Shifting timings</h2>
<p>So let‚Äôs see how we can coordinate the movements of the 3 dots. Maybe make the second wait a little before it goes and quickly reaches the end so that the 3rd still have some time left to make its way back.</p>
<p>For this, we need to transform the progress that each animation receives. Each will need to go from 0 to 1 while the progress of the <code>parallel</code> animation goes over smaller intervals.</p>
<p>Sounds a bit like easing, but it‚Äôs a very specific one. It sticks the progress to 0 while the progress hasn‚Äôt been enough, then ramps to 1 until the animation is done and from there sticks to one. It‚Äôs not so big to write on its own as:</p>
<figure>
    <script src="https://gist.github.com/rhumaric/7921124960e3a48511315c3f123c2626.js?file=shift.js"></script><p></p>
<div class="o-ratio o-ratio--16:9">
    <iframe src="/wp-content/uploads/demo/animation-with-functions/composing-animations/shift/">&#x26;#x26;#x3C;br />
    &#x26;#x26;#x3C;a href="/wp-content/uploads/demo/animation-with-functions/composing-animations/shift/">See the demo&#x26;#x26;#x3C;/a>&#x26;#x26;#x3C;br />
</iframe>
</div><figcaption class="u-ta-c" style="padding: 0.5em;">Click the dots to run the animation.</figcaption></figure>
<p>We got there! Composing functions we managed to animate different things on their own timing.</p>
<p>Of course, like the rest of this adventure, this is just a base to get started. On this topic especially, reasoning in percentages quickly becomes tricky if we want to create complex animations, for example. <a href="https://github.com/rhumaric/tinymation/issues/10">Reasoning in absolute units, like milliseconds</a> would be much easier.</p>
<p>And of course around the areas for making animations with functions. I‚Äôve started to gather some code on the <a href="https://github.com/rhumaric/tinymation">tinymation project on Github</a>. If you have thoughts on the topic, maybe specific use case, I‚Äôd be really happy to head about them. Feel free to <a href="https://github.com/rhumaric/tinymation">look at the code</a> and <a href="https://github.com/rhumaric/tinymation/issues">add issues (or comment on the existing ones)</a>.</p>
]]></description>
		<guid ispermalink="false">/?p=1114</guid>
		</item>
		<item>
		<title>Expressive scroll animations</title>
		<link>/writing-about/expressive-scroll-animations/
		<pubdate>Fri, 27 Oct 2017 19:36:58 +0000</pubdate>
		<dc:creator><!--[CDATA[romaricpascal]]--></dc:creator>
				<category><!--[CDATA[Animations]]--></category>
		<category><!--[CDATA[JS]]--></category>
		<description><!--[CDATA[<p--><a href="/writing-about/animations-with-javascript-functions/">The introduction of this venture in animations with JavaScript functions</a> created a source of progress to handle scroll animations.<br>
Its features were a bit basic though, limiting to ‚Äúover N% of the viewport height once past D%‚Äù.<p></p>
<p>I mean, it works but leaves it all to the developer to figure out those percentages, which might vary from screen size to screen size as the responsive design puts the element in a different position‚Ä¶ Not to mention the next change of design, introducing a new element higher up in the page and shifting the animated element down.</p>
<p>Let‚Äôs see if we can create something more expressive and resilient to design changes. When animating elements on scroll, percents of the viewport are not really the things we reason about first. It‚Äôs more natural to go for ‚Äústart when the <em>distance</em> from the <em>top of</em> the element to the <em>bottom of the viewport</em> reaches S<em>%</em> of the ~screen~<em>viewport height</em> and until it reaches E<em>%</em>‚Äù. So let‚Äôs shoot for that.</p>
<p>The highlighted parts of the sentence are each one concept we‚Äôre going to translate into JavaScript for this to work. There are two kinds of things there:</p>
<ol>
<li>Values, like the <em>top of</em> the element, the <em>bottom of the viewport</em> or the <em>viewport height</em>. But those vary with time: the window can be resized, the user can scroll‚Ä¶ So similarly to the sources of progress we have for the animations, we‚Äôll need sources of values here. </li>
<li>Computation over those values, like getting the <em>distance</em> between two points, or getting a <em>percentage</em>. Like a simple <code>-</code> or <code>/</code> operator, except they‚Äôll have to work with our sources of values we said we needed just above.</li>
</ol>
<h2 id="bottom-of-viewport-and-viewport-height"><a name="user-content-bottom-of-viewport-and-viewport-height" href="#bottom-of-viewport-and-viewport-height" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Bottom of viewport and viewport height</h2>
<p>Let‚Äôs start with the simplest values here, which are actually the same value if you think about it. From the top of the viewport (which we‚Äôll use as a common origin for our coordinates), they are the same value. And we don‚Äôt even need any computation to get it, the DOM provides it straight away: <code>document.body.clientHeight</code>.</p>
<p>The main thing we need to handle is making sure we can observe the changes of this value when the screen is resized.</p>
<figure><script src="https://gist.github.com/rhumaric/7e9497cdd97b9c839581105525e10585.js?file=bottomOfViewport.js"></script></figure>
<h2 id="top-of-el"><a name="user-content-top-of-el" href="#top-of-el" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Top of el</h2>
<p>Now we‚Äôve got our information about the viewport, let‚Äôs get those about the element. That‚Äôs the one that‚Äôll actually trigger changes on scroll, as the position of the element relative to the top of the viewport will change then.<br>
Here again, the DOM is pretty handdy providing that, with <code>el.getClientBoundingRect().top</code>.</p>
<figure>
<script src="https://gist.github.com/rhumaric/7e9497cdd97b9c839581105525e10585.js?file=topOf.js"></script><p></p>
<div class="o-ratio o-ratio--4:3">
<iframe src="/wp-content/uploads/demo/animation-with-functions/expressive-scroll/sources/">&#x26;#x26;#x3C;br />
    &#x26;#x26;#x3C;a href="wp-content/uploads/demo/animation-with-functions/expressive-scroll/sources/">See the demo&#x26;#x26;#x3C;/a>&#x26;#x26;#x3C;br />
</iframe>
</div><figcaption class="u-ta-c" style="padding: 0.5em;">First step out of the way, we can measure some dimensions \o/</figcaption></figure>
<p>And with that, we‚Äôre ready to move on to computing the distance and percentage.</p>
<h2 id="tbd"><a name="user-content-tbd" href="#tbd" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>TBD</h2>
<p>As the values above change, so will the distance and percentage. This means they also need to be sources of values. Sources of value that will:</p>
<ol>
<li>combine the value from different sources</li>
<li>compute a new value from there</li>
</ol>
<p>Combine, first. When observed, it‚Äôll need to observe the sources it combines and just provide their values in an array.</p>
<figure><script src="https://gist.github.com/rhumaric/7e9497cdd97b9c839581105525e10585.js?file=combine.js"></script></figure>
<p>From there we can create the final sources, consuming this array for computation, but only after all data is there:</p>
<figure>
<script src="https://gist.github.com/rhumaric/7e9497cdd97b9c839581105525e10585.js?file=distance.js"></script><p></p>
<div class="o-ratio o-ratio--4:3">
<iframe src="/wp-content/uploads/demo/animation-with-functions/expressive-scroll/combined/">&#x26;#x26;#x3C;br />
    &#x26;#x26;#x3C;a href="wp-content/uploads/demo/animation-with-functions/expressive-scroll/combined/">See the demo&#x26;#x26;#x3C;/a>&#x26;#x26;#x3C;br />
</iframe>
</div><figcaption class="u-ta-c" style="padding: 0.5em;">Combining all this, we can now fade the circle out on scroll \o/.</figcaption></figure>
<h2 id="tying-it-all-together"><a name="user-content-tying-it-all-together" href="#tying-it-all-together" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Tying it all together</h2>
<p>There we go! We have everything we need and can now write a more understandable: <code>percentOf(viewportHeight, distance(topOf(el), bottomOfViewport))</code> to use as our source of progress. As it is, it would animate as the element goes through the whole viewport. We just need one last wrapping source that will scale the percentage into a neat [0..1] range according to our wishes. Let‚Äôs call it <code>between(range, source)</code>.</p>
<figure>
<script src="https://gist.github.com/rhumaric/7e9497cdd97b9c839581105525e10585.js?file=between.js"></script><p></p>
<div class="o-ratio o-ratio--4:3">
<iframe src="/wp-content/uploads/demo/animation-with-functions/expressive-scroll/final/">&#x26;#x26;#x3C;br />
    &#x26;#x26;#x3C;a href="wp-content/uploads/demo/animation-with-functions/expressive-scroll/final/">See the demo&#x26;#x26;#x3C;/a>&#x26;#x26;#x3C;br />
</iframe>
</div><figcaption class="u-ta-c" style="padding: 0.5em;">Notice how the left circle only animates between the selected range.</figcaption></figure>
<p>And voila! Combining functions, we have a pretty expressive way to define scroll based animations.</p>
<p>As with the first article, this is just a base to start with, that I got from implementing scroll based animations on this website. There‚Äôd be plenty more to explore around those scroll sources like :<br>
 ‚Äì <a href="https://github.com/rhumaric/tinymation/issues/8">providing some based on the <code>intersectionRatio</code></a> from <a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver"><code>IntersectionObservers</code></a>,<br>
 ‚Äì <a href="https://github.com/rhumaric/tinymation/issues/9">handling conditions different landmarks on the element &#x26; viewport</a> (for example: start when the top of the element crosses the bottom of the viewport and end when its bottom crosses the top of the viewport‚Ä¶)<br>
 ‚Äì <a href="https://github.com/rhumaric/tinymation/issues">‚Ä¶</a></p>
<p>And of course around the areas for making animations with functions. I‚Äôve started to gather some code on the <a href="https://github.com/rhumaric/tinymation">tinymation project on Github</a>. If you have thoughts on the topic, maybe specific use case, I‚Äôd be really happy to head about them. Feel free to <a href="https://github.com/rhumaric/tinymation">look at the code</a> and <a href="https://github.com/rhumaric/tinymation/issues">add issues (or comment on the existing ones)</a>.</p>
<p>PS. If you enjoyed combining this concept of sources of values that vary over time, you might want to have a look around Observables and reactive libraries like <a href="https://github.com/Reactive-Extensions/RxJS">RxJS</a>, <a href="https://github.com/staltz/xstream">xstream</a>‚Ä¶</p>
]]></description>
		<guid ispermalink="false">/?p=1108</guid>
		</item>
		<item>
		<title>Animations with JavaScript functions</title>
		<link>/writing-about/animations-with-javascript-functions/
		<pubdate>Fri, 27 Oct 2017 19:36:54 +0000</pubdate>
		<dc:creator><!--[CDATA[romaricpascal]]--></dc:creator>
				<category><!--[CDATA[Animations]]--></category>
		<category><!--[CDATA[JS]]--></category>
		<description><!--[CDATA[<p-->This all started when I was looking to add scroll based animations to the home page of this portfolio. I set out to find a library to help a bit with that. There‚Äôs quite a few in the wild. Time-based animations libraries that I could then tie to the scroll position (like <a href="https://greensock.com/">greensock</a>, <a href="http://animejs.com">anime.js</a>, <a href="http://velocityjs.org">velocity</a> or <a href="https://github.com/tweenjs/tween.js/">tweenjs</a>). Or more scroll specific things (like <a href="http://scrollmagic.io">scrollmagic</a>).<p></p>
<p>While they all seemed to do a pretty good job (a lot of websites use them in production), they all had one major flaw to me. They‚Äôre all quite monolithic. They provide plenty, and your users download all that plenty, whether your website uses 1% or 99% of their features.</p>
<p>I used this as an excuse to explore how animations could be expressed through functions, rather than OOP APIs. Looking to compose just the features that the animations needed to limit what visitors would have to download. Let‚Äôs see how it went!</p>
<h2 id="a-simple-starting-point"><a class="headeranchor-link" href="#a-simple-starting-point" name="user-content-a-simple-starting-point" aria-hidden="true"></a>A simple starting point</h2>
<p>Before diving into complex animations driven by scroll, let‚Äôs start with a more restricted case: a simple time driven fade-in. Written in plain JS, this goes like this:</p>
<figure><script src="https://gist.github.com/rhumaric/c6c2c5b7382d4148df6119b5f1d473a8.js?file=time-from-scratch.js "></script><p></p>
<div class="o-ratio o-ratio--16:9"><iframe src="/wp-content/uploads/demo/animation-with-functions/intro/time-from-scratch/" width="300" height="150">&#x26;#x26;#x3C;br />
&#x26;#x26;#x3C;a href="wp-content/uploads/demo/animation-with-functions/intro/time-from-scratch/">Demo fading a button on click&#x26;#x26;#x3C;/a>&#x26;#x26;#x3C;br />
</iframe></div>
</figure>
<p>Definitely smaller than embedding a library. But while it‚Äôs nice to know how to write it all from scratch by hand, a bit of abstraction would help to reuse things from one animation to another.</p>
<h2 id="divide-and-conquer"><a class="headeranchor-link" href="#divide-and-conquer" name="user-content-divide-and-conquer" aria-hidden="true"></a>Divide and conquer</h2>
<p>The code above mixes two main parts of the animation:<br>
‚Äì generating some measure of <code>progress</code> (here using <a href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame">requestAnimationFrame</a> ticks)<br>
‚Äì interpolating this <code>progress</code> into updates of the UI (here with <code>target.style.opacity</code>)</p>
<p>So let‚Äôs split things up accordingly.</p>
<figure><script src="https://gist.github.com/rhumaric/c6c2c5b7382d4148df6119b5f1d473a8.js?file=time-split.js "></script><p></p>
<div class="o-ratio o-ratio--16:9"><iframe src="/wp-content/uploads/demo/animation-with-functions/intro/time-split/" width="300" height="150">&#x26;#x26;#x3C;br />
&#x26;#x26;#x3C;a href="wp-content/uploads/demo/animation-with-functions/intro/time-split/">Demo fading the button again on click&#x26;#x26;#x3C;/a>&#x26;#x26;#x3C;br />
</iframe></div>
</figure>
<p>That‚Äôs a first step! We can use our <code>timer</code> to power all kinds of animations. And control the <code>fadeIn</code> from other sources of progress‚Ä¶ the scroll position maybe.</p>
<h2 id="progress-on-scroll"><a class="headeranchor-link" href="#progress-on-scroll" name="user-content-progress-on-scroll" aria-hidden="true"></a>Progress on scroll</h2>
<p>A time-based source of progress works like this: ‚Äúrun for N ms (after a delay of D ms maybe)‚Äù. In the same spirit, a scroll based source of progress would go ‚Äúrun for N% of the scroll (after a delay of D% maybe)‚Äù. Pixels would work too, but given the diversity of screen heights around‚Ä¶ best use percents.</p>
<p>So let‚Äôs create just that (ignoring for now that the viewportHeight might change when resizing the browser):</p>
<figure><script src="https://gist.github.com/rhumaric/c6c2c5b7382d4148df6119b5f1d473a8.js?file=scroll-basic.js "></script><p></p>
<div class="o-ratio o-ratio--16:9"><iframe src="/wp-content/uploads/demo/animation-with-functions/intro/scroll-basic/" width="300" height="150">&#x26;#x26;#x3C;br />
&#x26;#x26;#x3C;a href="wp-content/uploads/demo/animation-with-functions/intro/scroll-basic/">Demo&#x26;#x26;#x3C;/a>&#x26;#x26;#x3C;br />
</iframe></div>
</figure>
<h2 id="going-further"><a class="headeranchor-link" href="#going-further" name="user-content-going-further" aria-hidden="true"></a>Going further</h2>
<p>This is just a simple base to start with. From there, there‚Äôs plenty more to explore, keeping this idea of composing functions to create animations. While creating this portfolio, I touched on:</p>
<ul>
<li><a href="/writing-about/expressive-scroll-animations/">having a more expressive source of ‚Äúscroll‚Äù events</a></li>
<li><a href="/writing-about/composing-animations-through-functions">composing animations on different elements</a></li>
</ul>
<p>And other topics come to mind too:</p>
<ul>
<li><a href="https://github.com/rhumaric/tinymation/issues/4">enhancing the rudimentary timer</a>: play/pause, reset, seek, repeat (alternating)</li>
<li><a href="https://github.com/rhumaric/tinymation/issues/5">splitting the computation of values from their use</a>, so they can be applied via CSS variables (to keep specificity low), used with canvas‚Ä¶</li>
<li><a href="https://github.com/rhumaric/tinymation/issues/6">listening on progress</a>, <a href="https://github.com/rhumaric/tinymation/issues/7">obtaining a promise of animation completion</a></li>
<li><a href="https://github.com/rhumaric/tinymation/issues">‚Ä¶</a></li>
</ul>
<p>I‚Äôve started to gather some code on the <a href="https://github.com/rhumaric/tinymation">tinymation project on Github</a>. If you have thoughts on the topic, maybe specific use case, I‚Äôd be really happy to head about them. Feel free to <a href="https://github.com/rhumaric/tinymation">look at the code</a> and <a href="https://github.com/rhumaric/tinymation/issues">add issues (or comment on the existing ones)</a>.</p>
]]></description>
		<guid ispermalink="false">/?p=1102</guid>
		</item>
		<item>
		<title>Reduce loading times of image-heavy sites with `srcset`</title>
		<link>/writing-about/reduce-loading-times-of-image-heavy-sites-with-srcset/
		<pubdate>Tue, 26 Sep 2017 12:52:52 +0000</pubdate>
		<dc:creator><!--[CDATA[romaricpascal]]--></dc:creator>
				<category><!--[CDATA[Images]]--></category>
		<category><!--[CDATA[Performances]]--></category>
		<description><!--[CDATA[<style-->
code { font-size: 135%; font-weight: bold; }

<p>This is the first article of a small series about techniques for keeping the loading times of image-heavy websites in check. Lots of images mean more KB to download for the browser. And in turn, longer loading times.</p>
<p>An obvious answer to the problem would be to cut down the number of images. But on some websites (this portfolio, for example) images are one of the main part of the content. Let‚Äôs see what we can do to keep things light.</p>
<blockquote style="margin-left: 0;margin-right: 0;padding: 1em;background: #FEE7B0;border-left: 5px solid #DCCCB1;font-size: 1.1em;">
<p>Use images at the right resolution in the right format </p>
</blockquote>
<p>For the first download at least, it pretty much comes down to that (you can set up caching rules to make future loads faster). Let‚Äôs leave the ‚Äúright format‚Äù  to its own future article (between vector or raster, optimised images, new formats like WebP and the <code>&#x3C;picture></code> element there‚Äôs a fair bit to explore). This article will focus on the ‚Äúright resolution‚Äù bit.</p>
<p>Loading an HD image when it‚Äôs only displayed 200px wide has several issues:</p>
<ul>
<li>it makes users wait, augmenting the risk of abandoning their visit</li>
<li>it needs more bandwidth, making users pay unnecessarily for their visit</li>
<li>it requires the browser to resize it heavily, making their device use more battery</li>
</ul>
<p>This article will also only deal with content images (<code>&#x3C;img></code> tags). A future one will deal with those that are in the CSS.</p>
<h2 id="the-problem"><a name="user-content-the-problem" href="#the-problem" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>The problem</h2>
<p>This ‚Äúright resolution‚Äù is not quite easy to pin, with websites getting accessed through a wide variety of devices:</p>
<ul>
<li>with different screen sizes,</li>
<li>and different pixel density.</li>
</ul>
<p>This means there won‚Äôt be a unique ‚Äúright resolution‚Äù. An image that 400px wide on a phone screen might get a much larger share of the screen on a desktop monitor.</p>
<p>Historically, the <code>&#x3C;img></code> tag only had the <code>src</code> attribute to provide the image URL. So which one to choose? A low res image will look terrible when scaled up on large displays. But a large image will blow up the loading times üôÅ</p>
<h2 id="srcset-to-the-rescue"><code>srcset</code> to the rescue</h2>
<p>What if we could let the browser choose? Give it a list of image URLs with different resolutions and let it pick which is the most appropriate to load. It‚Äôs well aware of the device that‚Äôs using it after all. Way more than the server it‚Äôs requesting the image to.</p>
<p>This is exactly the role of the <code>srcset</code> attribute on the <code>&#x3C;img></code> tag. Inside, you can list additional URLs the browser can load instead of the <code>src</code> one. Each is associated with a width or pixel density which will help the browser make its choice.</p>
<p>To pick an image with the appropriate width, though, the browser will need a bit more help. Viewing the website in a 1080px wide browser doesn‚Äôt mean all images will be 1080px wide. So we need to add some more hints with the <code>sizes</code> attribute. It contains a list of media queries (just like in CSS) to tell the browser which image to look for in the <code>srcset</code> depending on the situation. First match goes! (unlike in CSS).</p>
<p>This leads to markup that looks like that:</p>
<pre style="margin-left: 0;margin-right: 0;padding: 1em;background: #FEE7B0;border-left: 5px solid #DCCCB1;"><code class="html">&#x3C;img 
  src="/images/funnycat-200x150.jpg"
  height="150"
  width="200"
  srcset="/images/funnycat-400x300.jpg 400w,
          /images/funnycat-800x600.jpg 800w,
          /images/funnycat-800x600.jpg 3x"
  sizes="(min-width: 1600px) 800px,
         (min-width: 800px) 400px,
         200px">
</code></pre>
<p>With this, the browser can say ‚Äúhey! my screen is between 800 and 1600px wide. I can use the <code>funnycat-400x300.jpg</code> image instead of the <code>src</code> one‚Äù.</p>
<p>A couple of things to note:</p>
<ul>
<li>the width in the <code>srcset</code> are suffixed by <code>w</code>, but they‚Äôre actual CSS length in the <code>sizes</code> attributes. Easy to mix them up, so watch out! On the plus side, that means you can <code>calc()</code> things in the <code>sizes</code>.</li>
<li>the <code>src</code> is not necessarily the smallest image. A few browser don‚Äôt support <code>srcset</code> (<a href="http://caniuse.com/#search=srcset" target="blank" rel="noopener">IE, Edge 15 and before, and Opera Mini</a> as I‚Äôm writing this). They‚Äôll just use <code>src</code>, so a compromise will be needed between quality and load times there.</li>
<li>to follow the specs, the original <code>src</code> image must not appear in the <code>srcset</code> (nor should there be duplicate entries). Doesn‚Äôt seem to break the behaviour, just make the markup invalid.</li>
<li>to follow the specs again, if there are widths in the <code>srcset</code>, <a href="https://html.spec.whatwg.org/multipage/embedded-content.html#attr-img-sizes" target="blank" rel="noopener">the <code>sizes</code> attribute must be present</a>. Didn‚Äôt seem to break things either, just use the whole viewport width to pick the image width.</li>
</ul>
<h2 id="adding-the-srcset-attribute-to-your-site"><a name="user-content-adding-the-srcset-attribute-to-your-site" href="#adding-the-srcset-attribute-to-your-site" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Adding the <code>srcset</code> attribute to your site</h2>
<p>From a practical point of view, implementing <code>srcset</code> in your design is best done once the CSS has been finalised (or at least finalised enough for the image sizes to be set in stone).</p>
<h3 id="making-an-image-width-inventory"><a name="user-content-making-an-image-width-inventory" href="#making-an-image-width-inventory" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Making an image width inventory</h3>
<p>The first step is making an inventory of the image sizes for the different pages of your website at different screen sizes. Unfortunately, I don‚Äôt know of any crawler that does that automatically (that would be ideal, if you know of one, <a href="[/happy-to-chat]">please let me know</a>!), so it‚Äôll have to be a manual process.</p>
<p>There‚Äôs no need to go through each page, though. Only each ‚Äútemplate‚Äù. And equally, there‚Äôs no need to go through the whole width spectrum as you know the breakpoints in your CSS. </p>
<p>Some images might also be percent or viewport unit based. For those, you‚Äôll need to decide of size increments to adapt the served asset to the final design, just like more ‚Äúfixed‚Äù images.</p>
<h3 id="aggregating-the-sizes"><a name="user-content-aggregating-the-sizes" href="#aggregating-the-sizes" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Aggregating the sizes</h3>
<p>The inventory might leave you with quite a collection of sizes. In an ideal world, you‚Äôd provide each <code>&#x3C;img></code> tag its very own list of URLs and sizes. That can quickly lead to a maintenance overhead:</p>
<ul>
<li>generating and storing/caching of the images,</li>
<li>filling the <code>srcset</code> and <code>sizes</code> attributes accurately.</li>
</ul>
<p>To ease the burden a bit, you can regroup the sizes into similar sizes to reduce the number of images you have to handle. This might mean a few more pixels to download as the price of an easier maintenance. You‚Äôll have to weight if the trade-off is worth it.</p>
<h3 id="plan-for-different-pixel-densities"><a name="user-content-plan-for-different-pixel-densities" href="#plan-for-different-pixel-densities" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Plan for different pixel densities</h3>
<p>We now have a list of the images sizes we‚Äôll be implementing for our design. This is time to think of screens with high pixel density and not forget to plan for 2x and 3x versions of these images.</p>
<p>With a little <del>luck</del><ins>planning</ins>, these 2x and 3x might even match some of the other sizes, which will lower the number of images to generate.</p>
<h3 id="generate-the-images-and-write-the-srcset-and-sizes-attributes"><a name="user-content-generate-the-images-and-write-the-srcset-and-sizes-attributes" href="#generate-the-images-and-write-the-srcset-and-sizes-attributes" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Generate the images and write the <code>srcset</code> and <code>sizes</code> attributes</h3>
<p>These last two part will very much depend on how your website is set up.</p>
<p>For the generation, exporting every size from your favourite image editor will be tedious. I‚Äôd recommend leaving that to your CMS, some scripts or a SaaS platform.</p>
<p>Once all your images are ready, you can add the attributes to the markup and voila! Your users will load the appropriate image for their screen!</p>
<h2 id="in-the-end"><a name="user-content-in-the-end" href="#in-the-end" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>In the end</h2>
<p>The <code>srcset</code> attribute is a great way to shave some KB of download for your users by making your website load just the right image for the screen it‚Äôs viewed in. Of course, associating the screen size to the bandwidth available (and in turn loading time) is not a perfect correlation. But it‚Äôs a good place to start.</p>
<p>Hope this article was helpful to you. If you want to chat about it, feel free to <a href="/happy-to-chat">get in touch here</a> or on <a href="//twitter.com/romaricpascal">Twitter</a>.  </p>
]]></description>
		<guid ispermalink="false">/?p=1040</guid>
		</item>
		<item>
		<title>Lettering for the web</title>
		<link>/writing-about/lettering-for-the-web/
		<pubdate>Wed, 20 Sep 2017 15:03:43 +0000</pubdate>
		<dc:creator><!--[CDATA[romaricpascal]]--></dc:creator>
				<category><!--[CDATA[Process]]--></category>
		<description><!--[CDATA[<p-->Though they‚Äôre probably what comes to mind most easily, lettering is not limited to analog supports (prints, signs, murals‚Ä¶). It can be used in website designs too. This medium brings new challenges, but also offers rewarding possibilities. A few of my latest projects have required me to draw letters that would later be embedded on a website. Here are a couple of things I‚Äôve learnt along the way.<p></p>
<h2 id="pick-what-will-be-turned-into-lettering"><a class="headeranchor-link" href="#pick-what-will-be-turned-into-lettering" name="user-content-pick-what-will-be-turned-into-lettering" aria-hidden="true"></a>Pick what will be turned into lettering</h2>
<p>Offline, you‚Äôd probably wouldn‚Äôt consider to hand-letter the whole content of a book or magazine. It‚Äôs much simpler and cost effective to only use lettering for headings and illustrations, and leave the bulk of the copy to be set with fonts.</p>
<p>This also applies on the web, but another constraint gets thrown in when picking which parts are good candidates for being lettered. Websites are live and their content gets updated regularly. It‚Äôs easy to change a message set with a font, but for text that has been hand-lettered not so much: a new artwork has to get drawn with the updated message.</p>
<p>This means lettering should be reserved for parts that are foreseen to remain the same throughout the whole life of the website. Or that will at least allow enough time for a new lettering to be produced before the update. Good candidates would be headings of the main sections, or supporting illustrations for example.</p>
<p>Art direction will have a big impact here. Choosing simpler styles, limiting decorations around the lettering will allow quicker production times. This could help to give some lettering love to parts of the design that will just get updated every now and then.</p>
<p>And maybe it‚Äôll only be part of the design that will need regular editing. Lettering the static part while setting the editable bit with a font gives you the best of both worlds. An original rendering of the message and the ability to update what‚Äôs needed when the time comes.</p>
<figure>
<div class="o-ratio o-ratio--4:3">
<iframe src="/wp-content/uploads/demo/tedx-lettering-font/" style="border: none;"></iframe>
</div><figcaption class="u-ta-c" style="padding: 0.5em;">Paired font and lettering for <a href="https://tedxbristol.com" target="_blank" rel="noopener">TEDxBristol</a> branding</figcaption></figure>
<h2 id="then-be-even-pickier"><a class="headeranchor-link" href="#then-be-even-pickier" name="user-content-then-be-even-pickier" aria-hidden="true"></a>Then be even pickier</h2>
<p>Once they‚Äôve got that magazine in their hand, or they‚Äôre in front of a mural, viewers can enjoy the lettering instantly. Online, their device needs to download the content of the website before it can be shown to them.</p>
<p>Adding more images (which is what lettering is in the end), will add to the loading time, and <a href="https://blog.kissmetrics.com/loading-time/" target="_blank" rel="noopener">slow loading time drives users away</a>. So when planning a design that includes lettering, you‚Äôll need to keep this loading time in mind to pick which parts get lettered. Especially as not everybody will be seeing the website with the comfort of a fast broadband.</p>
<p>But this quest for performance doesn‚Äôt just impact what will get the lettering treatment. It also impacts the assets that will be created: the lighter the files the better.</p>
<p>Picking the right file format will be really important. For artworks with clean lines, <a href="https://en.wikipedia.org/wiki/Vector_graphics" target="_blank" rel="noopener">vector formats</a> will shine, especially as SVG is perfectly understood by the browsers. That said, if the artwork has rougher lines or some texture, rendering it to a JPEG or PNG might yield smaller files (and faster websites). This is for example what happened with the headings of this website.</p>
<p>And of course, you‚Äôll want to keep the resolution of these artworks in check. No need to download an HD artwork if it‚Äôll just be displayed in a 200px wide area.</p>
<h2 id="get-things-moving"><a class="headeranchor-link" href="#get-things-moving" name="user-content-get-things-moving" aria-hidden="true"></a>Get things moving</h2>
<p>So far, the web seems to be mostly adding more constraints to the work. It also allows things that would just not be possible with printed/painted media.</p>
<p>Like adding animations and interactions to the lettering pieces. Inside a browser, the parts of the artworks can move around, fade in or out and react to user interactions. </p>
<figure>
<div class="o-ratio o-ratio--4:3">
<iframe src="/wp-content/uploads/demo/animated-heading/" style="border: none;"></iframe>
</div><figcaption class="u-ta-c" style="padding: 0.5em;"><button class="rp-Button-naked rp-Link js-reloadIframe" data-target="[src=&#x22;/wp-content/uploads/demo/animated-heading/&#x22;]">Reload the demo and view the animation again.</button></figcaption></figure>
<p>Producing artworks for animation requires a bit more planning than a static image. Each part that will be animated need to be on its own so it can move independently from the other. And there‚Äôs of the course the design of the animation itself to do. But these animations can make the experience smoother and more engaging for users.</p>
<h2 id="embrace-responsiveness"><a class="headeranchor-link" href="#embrace-responsiveness" name="user-content-embrace-responsiveness" aria-hidden="true"></a>Embrace responsiveness</h2>
<p>Websites also get viewed through a wide variety of screens: from small but tall phone in your palms to large and wide TVs in your living room. Depending on the design, this means the space allowed for the lettering might vary from one screen to another.</p>
<p>At best, it would be a simple change of resolution. But it can also mean different screen display different images entirely. Fortunately, lettering is about is adapting the message to the space available. So with a little effort and planning, it is entirely possible to create artworks that will adapt to the space given by the screen.</p>
<figure>
<div class="o-ratio">
<iframe class="rp-OrientableFrame rp-OrientableFrame-portrait" src="/wp-content/uploads/demo/responsive-heading/"></iframe>
</div><figcaption class="u-ta-c" style="padding: 0.5em;"><button class="rp-Button-naked rp-Link js-rotateIframe" data-target=".rp-OrientableFrame">Change the space available to the demo and see how the lettering adapts</button></figcaption></figure>
<p>It‚Äôs actually an exciting challenge to create something that will have to morph according to the space that it is given.</p>
<p>In the end one of the strengths of lettering is adapting the form of the message to its support. The web is just another one of them. For the new constraints it gives, it also opens the door to create animated and interactive pieces, helping to make your message even more memorable. Have you encountered beautiful lettering pieces nicely integrated in the design of a site? I‚Äôd be happy to <a href="/happy-to-chat">hear about them</a>!</p>
]]></description>
		<guid ispermalink="false">/?p=1029</guid>
		</item>
		<item>
		<title>Responsive layout beyond width media queries</title>
		<link>/writing-about/responsive-layout-beyond-width-media-queries/
		<pubdate>Wed, 09 Aug 2017 12:01:35 +0000</pubdate>
		<dc:creator><!--[CDATA[romaricpascal]]--></dc:creator>
				<category><!--[CDATA[CSS]]--></category>
		<category><!--[CDATA[Responsiveness]]--></category>
		<description><!--[CDATA[<p-->When thinking of responsive layouts, the first thing that comes to mind is probably width based media queries: (<code>@media (min-width:...)</code> or <code>@media(max-width:...)</code>. CSS provides other means to adjust your designs to the screen size. Viewport units, calc, height and aspect-ratio media queries‚Ä¶ these are just a few of them. Let‚Äôs see how they can be of help following the enhancement of a page I‚Äôve recently been working on.<p></p>
<h2 id="starting-point"><a class="headeranchor-link" href="#starting-point" name="user-content-starting-point" aria-hidden="true"></a>Starting point</h2>
<p>The page in question is the <a href="/drawing-letters">artwork page</a> of my (soon to be)updated portfolio. Content-wise, there‚Äôs nothing too fancy. It‚Äôll obviously show a picture of the artwork. And provide a few additional things to complement it:</p>
<ul>
<li>a small caption (with a date of publication)</li>
<li>links to related pages (shop, project the artwork was for‚Ä¶)</li>
<li>a few other artworks to encourage discovery of content</li>
<li>social media share buttons.</li>
</ul>
<p>To navigate through the artworks, the page also features previous/next buttons. And that‚Äôs it. Like I said, nothing crazy, which leads to the no crazier HTML markup:</p>
<p><script src="https://gist.github.com/rhumaric/07b24a6779674b06fa55d6c4ba8158da.js?file=index.html"></script></p>
<p>With nothing more to control the layout, each block of content will just be stacked under the previous one and expand as the viewport‚Äôs width grow. <a href="/wp-content/uploads/responsive-layout-beyond-width-media-queries/starting-point/" target="_blank" rel="noopener">Here‚Äôs how it looks</a>. Let‚Äôs see how we can improve on that!</p>
<h2 id="viewport-units-and-calc"><a class="headeranchor-link" href="#viewport-units-and-calc" name="user-content-viewport-units-and-calc" aria-hidden="true"></a>Viewport units (and calc)</h2>
<p>First, we‚Äôll make some adjustments to the image. People get to this specific page to look at a picture. As the picture grows with the width, a limited height might come and crop it, only revealing the top part of the image at first.</p>
<p>Not an ideal first impression of the artwork, so let‚Äôs remedy to that and make sure the image is always visible in full. This means adapting its size to the height of the viewport, rather than the width, which is where viewport units come handy.</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/length#Viewport-percentage_lengths">Viewport units</a> are CSS length units that represent one percent of a size of the viewport:</p>
<ul>
<li><code>vw</code> for the width</li>
<li><code>vh</code> for the height</li>
<li><code>vmin</code> for the smallest of these dimensions</li>
<li><code>vmax</code> for the largest</li>
</ul>
<p>Using <code>vh</code>, we can now limit the size of the image so it fits the screen perfectly. We need to account for the header at the top though, which steals some space (`3em`) from the full height (which would be 100vh). <code><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/calc">calc</a></code> to the rescue! It‚Äôll do the computation using the different units to account for that. While we‚Äôre reducing the size we might as well shave a bit more height to make sure the caption starts showing and entices the user to scroll and read it.</p>
<p><script src="https://gist.github.com/rhumaric/07b24a6779674b06fa55d6c4ba8158da.js?file=viewport-units.css"></script></p>
<p>Good! Now whatever the screen, the image is always visible in full to start with. Let‚Äôs remember to add a link to a zoomed in version to let people look at the details too (but this part is not really about responsiveness, so let‚Äôs leave it out for now). <a href="/wp-content/uploads/responsive-layout-beyond-width-media-queries/viewport-units/" target="_blank" rel="noopener">Here‚Äôs the result</a>.</p>
<h2 id="height-media-queries"><a class="headeranchor-link" href="#height-media-queries" name="user-content-height-media-queries" aria-hidden="true"></a>Height media queries</h2>
<p>As the height grows now, so will the image, and if the width of the screen allows it, it‚Äôll take the whole viewport if it can. This works well on small screens but feels a bit cramped past a certain width. Not to mention the line length of the caption growing past what‚Äôs comfortable for reading. Let‚Äôs improve that!</p>
<p>Playing with the width of the viewport (resizing the browser or using its responsive design dev tools), we can decide past which width things are breaking.</p>
<p>Then, usually, that‚Äôll be dealt with using a width media query: past a certain viewport width, set the <code>max-width</code> of the element to a fixed value. Our image size is adjusted to the height of the screen this time. This means we‚Äôll need to use a height media query (and not forget to add back the length we‚Äôre removing in the <code>calc</code>).</p>
<p><script src="https://gist.github.com/rhumaric/07b24a6779674b06fa55d6c4ba8158da.js?file=height-media-queries.css"></script></p>
<p>This makes things much nicer on a bigger screen. Win! <a href="/wp-content/uploads/responsive-layout-beyond-width-media-queries/height-media-queries/" target="_blank" rel="noopener">It looks like this now</a>.</p>
<h2 id="aspect-ratio-media-queries"><a class="headeranchor-link" href="#aspect-ratio-media-queries" name="user-content-aspect-ratio-media-queries" aria-hidden="true"></a>Aspect ratio media queries</h2>
<p>That last adjustment gained us quite a bit of space (when available) on the sides of the content. This would be a much-improved place for the previous/next links, promoting navigation through the series of artworks.</p>
<p>The question is‚Ä¶ when is that space available? We‚Äôve got space when the overall width is more than the sum of the image width and the necessary width to put the two buttons: <code>min-width: &#x3C;image-width> + 2 * &#x3C;button-width></code>.</p>
<p>Like earlier, though, the viewport‚Äôs height is at play here, because of it‚Äôs relation to the content width. Our minimum width is actually: <code>min-width: (&#x3C;full-height> - &#x3C;reserved-spacing>) + 2 * &#x3C;button-width></code>.</p>
<p>It looks like another job for <code>calc</code>‚Ä¶ except <a href="https://www.w3.org/TR/css3-mediaqueries/#media1">media queries do not support <code>calc</code>ed values</a> üôÅ Fortunately, they do support a media feature that expresses a relation between the width and height: <code>aspect-ratio</code>. Rounding the previous sum into a ratio will not make things as precise, but will be enough to guarantee the space for small width.</p>
<p><script src="https://gist.github.com/rhumaric/07b24a6779674b06fa55d6c4ba8158da.js?file=aspect-ratio-media-queries.css"></script></p>
<p>Great! When there‚Äôs enough space, people now get a quicker access to the navigation! <a href="/wp-content/uploads/responsive-layout-beyond-width-media-queries/aspect-ratio-media-queries/" target="_blank" rel="noopener">Check it out</a>.</p>
<h2 id="combining-media-queries"><a class="headeranchor-link" href="#combining-media-queries" name="user-content-combining-media-queries" aria-hidden="true"></a>Combining media queries</h2>
<p>Past the ‚Äúfixed width‚Äù breakpoint, the positioning of the navigation buttons breaks a bit. The buttons are displayed, but they grow further and further from the content as the height grows.</p>
<p>For large heights, also, the <code>aspect-ratio</code> query shows its limitations. As the height gets bigger, the query requires a larger and larger viewport width to be triggered. This makes viewports where there‚Äôd obviously been space for the arrows miss out on the enhancement.</p>
<p>At that point, the image size is set. We can just combine a ‚Äúclassic‚Äù <code>min-width</code> query to the <code>min-height</code> one to ensure the arrows will get displayed on screens with enough space, but not fitting the previous <code>aspect-ratio</code>.</p>
<p><script src="https://gist.github.com/rhumaric/07b24a6779674b06fa55d6c4ba8158da.js?file=combined-media-queries.css"></script></p>
<p>And now that‚Äôs better! No more missing navigation when there‚Äôs space for it. <a href="/wp-content/uploads/responsive-layout-beyond-width-media-queries/combined-media-queries/" target="_blank" rel="noopener">And there we are</a>.</p>
<h2 id="conclusion"><a class="headeranchor-link" href="#conclusion" name="user-content-conclusion" aria-hidden="true"></a>Conclusion</h2>
<p>Further improvements could be made to the design (that unique column makes things look a bit empty at large width, for example). They wouldn‚Äôt rely on different mechanisms than the ones already described so let‚Äôs leave it there. Plus, that would spoil the surprise of unveiling the new design üòâ</p>
<p>These 4 CSS features have allowed us to get finer control on how the content would adapt to different viewports. I hope you‚Äôll find them useful if <code>min-width</code> or <code>max-width</code> don‚Äôt solve your layout problem. I‚Äôd be happy to hear how they worked for you, or if you use other features too to adapt your designs.</p>
<p><span style="border-radius: 2px; text-indent: 20px; width: auto; padding: 0px 4px 0px 0px; text-align: center; font: bold 11px/20px &#x27;Helvetica Neue&#x27;,Helvetica,sans-serif; color: #ffffff; background: #bd081c no-repeat scroll 3px 50% / 14px 14px; position: absolute; opacity: 1; z-index: 8675309; display: none; cursor: pointer;">Save</span></p>
<p><span style="border-radius: 2px; text-indent: 20px; width: auto; padding: 0px 4px 0px 0px; text-align: center; font: bold 11px/20px &#x27;Helvetica Neue&#x27;,Helvetica,sans-serif; color: #ffffff; background: #bd081c no-repeat scroll 3px 50% / 14px 14px; position: absolute; opacity: 1; z-index: 8675309; display: none; cursor: pointer;">Save</span></p>
<p><span style="border-radius: 2px; text-indent: 20px; width: auto; padding: 0px 4px 0px 0px; text-align: center; font: bold 11px/20px &#x27;Helvetica Neue&#x27;,Helvetica,sans-serif; color: #ffffff; background: #bd081c no-repeat scroll 3px 50% / 14px 14px; position: absolute; opacity: 1; z-index: 8675309; display: none; cursor: pointer;">Save</span></p>
<p><span style="border-radius: 2px; text-indent: 20px; width: auto; padding: 0px 4px 0px 0px; text-align: center; font: bold 11px/20px &#x27;Helvetica Neue&#x27;,Helvetica,sans-serif; color: #ffffff; background: #bd081c no-repeat scroll 3px 50% / 14px 14px; position: absolute; opacity: 1; z-index: 8675309; display: none; cursor: pointer;">Save</span></p>
<p><span style="border-radius: 2px; text-indent: 20px; width: auto; padding: 0px 4px 0px 0px; text-align: center; font: bold 11px/20px &#x27;Helvetica Neue&#x27;,Helvetica,sans-serif; color: #ffffff; background: #bd081c  no-repeat scroll 3px 50% / 14px 14px; position: absolute; opacity: 1; z-index: 8675309; display: none; cursor: pointer;">Save</span></p>
]]></description>
		<guid ispermalink="false">/?p=894</guid>
		</item>
		<item>
		<title>Setting up Piwik log analytics on an OVH shared hosting</title>
		<link>/writing-about/setting-up-piwik-log-analytics-on-an-ovh-shared-hosting/
		<pubdate>Wed, 22 Mar 2017 13:26:42 +0000</pubdate>
		<dc:creator><!--[CDATA[romaricpascal]]--></dc:creator>
				<category><!--[CDATA[Analytics]]--></category>
		<category><!--[CDATA[Piwik]]--></category>
		<description><!--[CDATA[<article class="markdown-body"-->Analytics help you see how users interact with your website. This can help identify which topics they are most interested in, or which step or your sales funnel has most users give up on buying your product. I‚Äôve recently set up <a href="https://piwik.org">Piwik</a> to keep an eye on the traffic on my website using their <a href="https://piwik.org/log-analytics/">log analytics feature</a>, automatically importing the previous days log into the tool every night. There were 4 main steps to getting it working:<p></p>
<ol>
<li>Hosting Piwik</li>
<li>Writing a script to import the log into Piwik</li>
<li>Writing a script to download the logs automatically</li>
<li>Setting up a Cron job to run the combination of both scripts every night</li>
</ol>
<h2 id="piwik-not-google-analytics"><a class="headeranchor-link" href="#piwik-not-google-analytics" name="user-content-piwik-not-google-analytics"></a>Piwik, not Google Analytics</h2>
<p>The most famous tool in this area is Google Analytics. While powerful, it sends data from the visitors of my site to a 3rd party (Google) whose business is selling ads by tracking people around the web. That makes me a bit wary regarding users‚Äô privacy.</p>
<p>To keep control of that data, a strong alternative is <a href="https://piwik.org">Piwik</a>. It‚Äôs open-source and free to host on your own servers. This put you in control of the collected data and the respect of your users‚Äô privacy (Do Not Track browser setting, IP Anonymisation‚Ä¶).</p>
<p>There are different ways to go for it. Similar to Google Analytics, you can embed a piece of JavaScript on your pages which will notify Piwik when users visit them. Or you can feed Piwik your server logs. As my website doesn‚Äôt have other client side interactions to track, nor does it load much content via JavaScript, log analytics would be enough. One less script to download for the users, no tracking cookie, and additionally, I‚Äôll be able to see requests for non-existing pages. This might allow me to detect when something breaks. Though at the moment, it mostly shows me where attackers are trying to poke for WordPress or its plugins vulnerabilities.</p>
<h2 id="hosting-piwik"><a class="headeranchor-link" href="#hosting-piwik" name="user-content-hosting-piwik"></a>Hosting Piwik</h2>
<p>The first step is obviously to get Piwik running, ideally hosted on a separate vhost and with a separate database from your main website. After creating a new site and database on OVH‚Äôs hosting admin panel, Piwik‚Äôs installation is pretty straightforward following their <a href="https://piwik.org/docs/installation/">user guide</a>.</p>
<p>With Piwik ready to receive data, let‚Äôs work backward and look first at how to feed it the logs.</p>
<h2 id="importing-the-logs-in-piwik"><a class="headeranchor-link" href="#importing-the-logs-in-piwik" name="user-content-importing-the-logs-in-piwik"></a>Importing the logs in Piwik</h2>
<p>Along with the PHP file providing the UI and endpoint for the JS tracker, Piwik also provides a Python Script for importing logs into it. All our import script needs to do is configure the command with the appropriate options.</p>
<p><script src="https://gist.github.com/rhumaric/1cbbc162d2b129b2910701b61d903382.js?file=piwik-import.sh"></script></p>
<p>The script requires some kind of authentication to import the data into Piwik. Either the login/password combination you use to login to the UI, or an auth token that you can generate from the Piwik UI. Either way, these are kept our of the script to make it portable, and the appropriate flags (<code>--login</code> &#x26; <code>--password</code>, or <code>--token-auth</code>) are stored in a separate <code>.piwikauth</code> file.</p>
<p>The tool also needed a bit of help to parse the logs. The log format for OVH‚Äôs shared hosting doesn‚Äôt match exactly one of the well-know log formats supported by the import tool. This prevented the script from extracting the host information from the script, so a specific regex had to be provided with <code>--log-format-regex</code>.</p>
<p>With the host information at hand, the tool could now generate Piwik sites for each host encountered in the log thanks to the <code>--add-sites-new-hosts</code>. If you‚Äôre only interested in specific hosts, you can filter the logs with the <code>--hostname</code> option.</p>
<p>Last, Piwik import tool will ignore static file downloads, HTTP redirects, and HTTP errors by default. It provides <code>--enable-&#x3C;XYZ></code> flags to include them in the import, though. Redirects added too much noise to the stats, but HTTP errors were definitely something I‚Äôm interested in. And I‚Äôm thinking downloads could help have a view of the RSS feed audience (tracking a query parameter on images loaded from RSS, for example) so I kept them too.</p>
<p>But to import logs into Piwik‚Ä¶ well‚Ä¶ we need logs. Let‚Äôs see how to collect them.</p>
<h2 id="downloading-ovh-logs"><a class="headeranchor-link" href="#downloading-ovh-logs" name="user-content-downloading-ovh-logs"></a>Downloading OVH logs</h2>
<p>For shared hostings, OVH provides access to GZipped versions of the Apache logs. Of course, they are not publicly accessible. In the ‚ÄúStatistics and logs‚Äù section of the hosting admin panel, you can create login/password to clear access to them.</p>
<p>From there, the super structured URLs make it easy to collect the logs for a given date.</p>
<p><script src="https://gist.github.com/rhumaric/1cbbc162d2b129b2910701b61d903382.js?file=ovh-download-logs.sh"></script></p>
<p>As for the Piwik import script, the credentials are kept out of the script. You‚Äôll need to put the necessary <code>--user</code> and <code>--password</code> <code>curl</code> flags in a separate <code>.curlauth</code> file.</p>
<p>The different parts are ready, time to combine them together.</p>
<h2 id="setting-up-a-cron-job"><a class="headeranchor-link" href="#setting-up-a-cron-job" name="user-content-setting-up-a-cron-job"></a>Setting up a Cron job</h2>
<p><code>Cron</code> is a tool that schedules scripts to run at regular intervals. That‚Äôs what we‚Äôll use to run the import every night. To make things simpler, one last script is needed, that will combine the two previous one and make the magic happen.</p>
<p><script src="https://gist.github.com/rhumaric/1cbbc162d2b129b2910701b61d903382.js?file=import-yesterdays-log.sh"></script></p>
<p>Now all the scripts are ready, the last steps start with uploading them to the server. Ideally, you want them in a folder that‚Äôs not accessible from the internet (or at least with no access to the <code>.*auth</code> files). Make sure they can be executed with <code>chmod a+x *.sh</code> inside the folder they‚Äôre stored. And finally, in the hosting admin panel, you‚Äôll need to schedule a new job to run every day, using the path to the <code>import-yesterdays-log.sh</code> script.</p>
<p><em>Note:</em> You might want to test things out before setting up the Cron job. Quick catch there, it‚Äôs a bit more convoluted than SSHing to the server and running the last script from the command line, unfortunately. OVH seems to prevent network access to scripts on their shared hosting when run from an SSH connection. All is not lost, though! You can create a small PHP page running the import script and showing its output to try the script out.</p>
<p>Voila! Your shared hosting logs will get imported into Piwik every night and you can start analysing your traffic. If you need to <a href="mailto:hello@romaricpascal.is">Let me know how this worked for you</a> if you decide to set it up too. And if you have any question, of course, <a href="mailto:hello@romaricpascal.is">feel free to contact me</a>.</p>

]]></description>
		<guid ispermalink="false">/?p=600</guid>
		</item>
		<item>
		<title>Overlays with fixed positioning</title>
		<link>/writing-about/overlays-with-fixed-positioning/
		<pubdate>Wed, 08 Mar 2017 13:09:24 +0000</pubdate>
		<dc:creator><!--[CDATA[romaricpascal]]--></dc:creator>
				<category><!--[CDATA[CSS]]--></category>
		<description><!--[CDATA[<p--><code>position: fixed;</code> is a much older feature of CSS than <a href="/adding-visual-interest-with-css-grid-layout/">CSS grid</a>. Many patterns of modern web applications can be implemented with it, though. It is especially handy when something needs to get overlaid on top of the viewport, without changing <em>where it sits in the HTML</em>.<p></p>
<h2 id="a-different-kind-of-position-absolute"><a class="headeranchor-link" href="#a-different-kind-of-position-absolute" name="user-content-a-different-kind-of-position-absolute"></a>A different kind of <code>position: absolute</code></h2>
<p>Like <code>position: absolute;</code>, <code>position: fixed;</code> removes the element it is applied to from the flow, collapsing the space it was due to take in the layout. It then positions it according to a combination of <code>top</code>/<code>bottom</code> &#x26; <code>left</code>/<code>right</code> offsets. The difference lies in according to what the element will be positioned. <code>position: absolute</code> uses the nearest ancestor whose <code>position</code> is not <code>static</code>. <code>position: fixed</code> uses the viewport, which is what makes it so handy to overlay things. On top of that, as the element is positioned according to the viewport, it‚Äôll stay in position as users scroll the content underneath it.</p>
<h2 id="dialog"><a class="headeranchor-link" href="#dialog" name="user-content-dialog"></a>Dialog</h2>
<p>First thought when it comes to overlaying something is probably displaying a dialog for users to complete a small action. Let‚Äôs move the overlay to the center with:</p>
<pre><code class="css">.o-overlay--dialog {
    top: 50%;
    left: 50%;
    tansform: translate(-50%, -50%);
}
</code></pre>
<p>As we just specified two of the positioning offsets, the width and height will grow unconstrained, though. Super long words or a large amount of content might make things end up out of the viewport if we just leave it as is. To avoid that, let‚Äôs constrain the width and height a bit.</p>
<pre><code class="css">.o-overlay--dialog {
    /* ... */
    max-width: 100%;
    max-height: 100%;
    overflow: auto;
}
</code></pre>
<p>Voila! A dialog that can appear anywhere in the HTML and still be displayed at the center of the viewport, on top of the content.</p>
<p><iframe src="//jsfiddle.net/rhumaric/1zzfvfem/4/embedded/result,css,html/" width="100%" height="300" frameborder="0" allowfullscreen></iframe></p>
<h2 id="cover"><a class="headeranchor-link" href="#cover" name="user-content-cover"></a>Cover</h2>
<p>Sometimes, you might want to grab users full attention and cover everything. Without unloading the content that‚Äôs already there. Setting each offset to 0 will do just that (provided the element doesn‚Äôt have any margin).</p>
<pre><code class="css">.o-overlay--cover {
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    margin: 0;
    overflow: auto;
}
</code></pre>
<p><iframe src="//jsfiddle.net/rhumaric/1zzfvfem/5/embedded/result,css,html/" width="100%" height="300" frameborder="0" allowfullscreen></iframe></p>
<h2 id="modal"><a class="headeranchor-link" href="#modal" name="user-content-modal"></a>Modal</h2>
<p>Combining the two previous patterns, we can quickly get a modal window, which will prevent users from clicking/tapping the underlying content.</p>
<p><iframe src="//jsfiddle.net/rhumaric/1zzfvfem/6/embedded/result,css,html/" width="100%" height="300" frameborder="0" allowfullscreen></iframe></p>
<h2 id="side-panels"><a class="headeranchor-link" href="#side-panels" name="user-content-side-panels"></a>Side panels</h2>
<p>If you lose one of the offsets of the cover, you get side panels ready to contain a menu, additional side information or complex form controls. Depending on the content again, you‚Äôll want to restrict the height or width to make sure the content doesn‚Äôt just spread over everything. For a left panel, this becomes:</p>
<pre><code class="css">.o-overlay--panelLeft {
  top: 0;
  left: 0;
  bottom: 0;
  overflow: auto;

  max-width: 40%;
}
</code></pre>
<p><iframe src="//jsfiddle.net/rhumaric/1zzfvfem/7/embedded/result,css,html/" width="100%" height="300" frameborder="0" allowfullscreen></iframe></p>
<h2 id="small-notifications"><a class="headeranchor-link" href="#small-notifications" name="user-content-small-notifications"></a>Small notifications</h2>
<p>Add a bit of margin (or more offset) to a panel displayed from the top and you get a nice container for a quick notification. This would enable a form component to completely control the markup of its success message, while displaying where needed to attract some attention.</p>
<pre><code class="css">.o-overlay-toastTop {
  top: 1em;
  left: 1em;
  right: 1em;
}
</code></pre>
<p><iframe src="//jsfiddle.net/rhumaric/1zzfvfem/9/embedded/result,css,html/" width="100%" height="300" frameborder="0" allowfullscreen></iframe></p>
<p>Playing with offsets, margins, and widths, you can get a wide variety of layouts. Vertical toolbars on the side of the viewport, chat windows popping from the bottom come to mind as other examples. These were just a few examples of how fixed positioning can help with some patterns found regularly in modern applications. While they surely could be implemented some other way, <code>position: fixed;</code> has this advantage of displaying things in a different place without touching the markup. A big plus when it comes to keeping things encapsulated. The markup for the modal window used by your custom form component can sit right inside that component, next to the <code>&#x3C;input></code> it enhances, rather than having to be appended some way to the <code>&#x3C;body></code>. As most techniques, it‚Äôs not a silver bullet, but it definitely comes handy. <a href="mailto:hello@romaricpascal.is">Let me know what you think of it!</a></p>
]]></description>
		<guid ispermalink="false">/?p=561</guid>
		</item>
		<item>
		<title>Adding visual interest with CSS Grid layout</title>
		<link>/writing-about/adding-visual-interest-with-css-grid-layout/
		<pubdate>Thu, 23 Feb 2017 10:53:14 +0000</pubdate>
		<dc:creator><!--[CDATA[romaricpascal]]--></dc:creator>
				<category><!--[CDATA[CSS]]--></category>
		<category><!--[CDATA[Grid Layout]]--></category>
		<description><!--[CDATA[<p-->If you‚Äôve wandered a bit on this website, you might have ended up on the page displaying my <a href="/drawing-letters">lettering works</a>. It displays a mosaic of my latest artwork entries. It‚Äôs basic layout is a grid of square images. It does the job, but it‚Äôs visually boring: all images have the same size, they‚Äôre all aligned neatly‚Ä¶ Having a bit of variation in the sizes of the images would make things a bit more interesting. Something like this:<p></p>
<div style="display: flex; align-items: center; justify-content: space-around; flex-wrap: wrap;">
<figure style="border: solid 1px currentColor; padding: 1em;">
<img src="/wp-content/uploads/2017/02/css-without-grid-screenshot.jpg" alt="" width="767" height="618" class="alignnone size-full wp-image-501" style="max-width: 250px;" srcset="/wp-content/uploads/2017/02/css-without-grid-screenshot.jpg 767w, /wp-content/uploads/2017/02/css-without-grid-screenshot-300x242.jpg 300w, /wp-content/uploads/2017/02/css-without-grid-screenshot-200x161.jpg 200w, /wp-content/uploads/2017/02/css-without-grid-screenshot-400x322.jpg 400w" sizes="(max-width: 767px) 100vw, 767px"><figcaption style="font-family: filsonsoft-bold; text-align: center;">Basic layout</figcaption></figure>
<figure style="border: solid 1px currentColor; padding: 1em;">
<img src="/wp-content/uploads/2017/02/css-grid-screenshot.jpg" alt="" width="765" height="901" class="alignnone size-full wp-image-494" style="max-width: 250px;" srcset="/wp-content/uploads/2017/02/css-grid-screenshot.jpg 765w, /wp-content/uploads/2017/02/css-grid-screenshot-255x300.jpg 255w, /wp-content/uploads/2017/02/css-grid-screenshot-200x236.jpg 200w, /wp-content/uploads/2017/02/css-grid-screenshot-400x471.jpg 400w" sizes="(max-width: 765px) 100vw, 765px"><figcaption style="font-family: filsonsoft-bold; text-align: center;">Enhanced layout</figcaption></figure>
</div>
<h2><a name="user-content-maybe-you-see-it-maybe-you-dont" href="#maybe-you-see-it-maybe-you-dont" aria-hidden="true"><span></span></a>Maybe you see it, maybe you don‚Äôt</h2>
<p>Rather than using a JavaScript solution to position the images, the layout relies on a recent CSS specification: Grid layout. It leaves the maths for positioning the images to the browsers, following a spec‚Äôed algorithm that would work the same in each of them. </p>
<p>Not all browsers have implemented it yet, though. It means some people will see the nicer layout and others won‚Äôt. <a href="http://dowebsitesneedtolookexactlythesameineverybrowser.com/">That‚Äôs OK</a>. Everyone will see the images in a good enough layout. The Grid one just providing some final enhancement. And as browser support grows, more and more people will get the nicer one. Progressive enhancement FTW!!!.</p>
<p>So how is that Grid layout different from the other CSS layouts so far?</p>
<p>It lets the parent divide itself into rows and columns which will help position its children. By default, the first child would go into first cell, second child in the second cell‚Ä¶ But the grid layout lets you also pick where and how big the children will be displayed. Want the first child to be on the 3rd row, 4th column and span 2 columns wide? The Grid layout has you covered. The other children will then flow back from the first cell.</p>
<p>In practice, let‚Äôs see what happens to the <a href="/drawing-letters">artworks page</a>.</p>
<h2><a name="user-content-setting-up-the-grid" href="#setting-up-the-grid" aria-hidden="true"><span></span></a>Setting up the grid</h2>
<p>First, the <code>.rp-ArtworksList-grid</code> element gets divided into a regular grid on 128px squares (1/6th of the total container width).</p>
<pre><code>.rp-ArtworksList-grid {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  grit-auto-rows: 128px;
}
</code></pre>
<p>The <code>grid-template-columns</code> property defines how many columns there are and how big they are. If some columns are the same, the Grid layout specification profides a handy way to not type N times the same value with the nice <code>repeat()</code> shortcut. Additionally it introduces a new unit to define lenghts in ‚Äúfractions of the remaining space‚Äù, the <code>fr</code> unit. This makes dividing the width of the grid in 6 equal columns a piece of cake: <code>repeat(6, 1fr)</code>. </p>
<p>A corresponding <code>grid-template-rows</code> exists to set the height of the rows. However, grids can also be made to extend automatically, with two properties that let you define the size of new rows (and columns): <code>grid-auto-rows</code> (<code>grid-auto-columns</code>) properties. There‚Äôs an <code>auto</code> value that should adapt the height to the children. I couldn‚Äôt get it to work well in complement of the padding technique to fix aspect ratios. So hardcoded value it was üôÅ</p>
<h2><a name="user-content-positionning-the-children" href="#positionning-the-children" aria-hidden="true"><span></span></a>Positionning the children</h2>
<p>As it is, the grid is just a replica of the regulare square tiling. To add some visual interest, we still need to move some of the children in specific positions.</p>
<pre><code>.rp-ArtworksList_item:nth-child(1) {
  grid-column-start: 1;
  grid-column-end: span 3;
  grid-row-start: 1;
  grid-row-end: span 3;
}

.rp-AtworksList_item:nth-child(2) {
  grid-column-start: span 2;
  grid-column-end: -1;
  grid-row-start: 2;
  grid-row-end: span 2;
}

...
</code></pre>
<p>The 4 properties <code>grid-column-start</code> &#x26; <code>grid-column-end</code>, and <code>grid-row-start</code> &#x26; <code>grid-row-end</code> define where the element will sit on the grid. You can define these either with row/column numbers, from the start (positive number) or the end (negative number) of the row/column. But you can also set over a span of how many rows/column they should be. This makes it a breeze to position the second big square at the end of the row, twice as big as the small squares, for example.</p>
<p>The layout only used a tiny part of the specification, but it got me really excited about having Grid layout available into more and more browsers. It obviously won‚Äôt be one to use for every layout (no need to roll a grid if you just line things up vertically), but it makes creating complex layouts way easier. For now, I‚Äôll keep it at hand for a final layer of enhancement, like on the <a href="/drawing-letters">artworks page</a>.</p>
]]></description>
		<guid ispermalink="false">/?p=491</guid>
		</item>
		<item>
		<title>A tidy WordPress project repository with Composer</title>
		<link>/writing-about/a-tidy-wordpress-project-repository-with-composer/
		<pubdate>Wed, 08 Feb 2017 15:47:00 +0000</pubdate>
		<dc:creator><!--[CDATA[romaricpascal]]--></dc:creator>
				<category><!--[CDATA[Composer]]--></category>
		<category><!--[CDATA[PHP]]--></category>
		<category><!--[CDATA[Wordpress]]--></category>
		<description><!--[CDATA[<p-->A WordPress project usually involves creating custom theme(s) and/or plugin(s) and adding them to a WordPress install, along with maybe a few 3rd party plugins or a parent theme. Having WordPress and these 3rd party elements in the repository make it unnecessarily big.<p></p>
<p>An alternative to storing the 3rd party code your project use into its repository is to use a dependency manager. Dependency managers are tools that let you store a list of these 3rd party libraries in your repository, and will take charge of downloading them and installing them in your project. Which is what <a href="https://getcomposer.org/">Composer</a> does. Let‚Äôs see how we can use it to keep our repository tidy.</p>
<h2><a href="#composer-in-a-few-lines" name="user-content-composer-in-a-few-lines"></a>Composer in a few lines</h2>
<p>First step is obviously to install Composer on your machine. <a href="https://getcomposer.org/doc/00-intro.md">The tool‚Äôs getting started guide</a> will guide you through these steps.</p>
<p>Composer works with a <code>composer.json</code> file that lists the dependencies of your project. The most common type of dependencies are 3rd party libraries. Composer will fetch them from its default package repository <a href="https://packagist.org/">Packagist</a> (or other repositories listed in the <code>composer.json</code> file). Additionaly, you can specify that your project needs specific PHP extensions to work properly or features from a minimum PHP version. This helps making sure all necessary things are present for your project to work properly.</p>
<p>The <code>composer install</code> command then installs all the listed dependencies, downloading them as needed.</p>
<h2><a href="#downloading-wordpress-with-composer" name="user-content-downloading-wordpress-with-composer"></a>Downloading WordPress with Composer</h2>
<p>With composer ready, let‚Äôs set it up to download WordPress. Unfortunately, WordPress doesn‚Äôt have any package stored on <a href="https://packagist.org/">Packagist</a>. That doesn‚Äôt mean Composer can‚Äôt work with it, though. Composer can <a href="https://getcomposer.org/doc/05-repositories.md">use other repositories</a> and is perfectly capable to download a zip file from Github, for example. The corresponding <code>composer.json</code> is the following.</p>
<div>
<pre>{
  "repositories":[{
    "type": "package",
    "package": {
      "name": "wordpress",
      "version": "4.7.2",
      "dist": {
        "type": "zip",
        "url": "https://github.com/WordPress/WordPress/archive/4.7.2.zip"
      }
    }
  }],
  "require": {
    "wordpress":"4.7.2"
  }
}
</pre>
</div>
<p>Run <code>composer install</code> and WordPress will be downloaded‚Ä¶ in the <code>vendor/wordpress</code> folder. Not quite where you‚Äôd want it‚Ä¶</p>
<h2><a href="#downloading-wordpress-in-a-handier-location" name="user-content-downloading-wordpress-in-a-handier-location"></a>Downloading WordPress in a handier location</h2>
<p>A more common folder structure would be having WordPress‚Äô files at the root of the project. This structure makes it a hassle when it comes to manage files blacklisted in <code>.gitignore</code> (or <code>.hgignore</code>, or <code>.&#x3C;whatever>ignore</code>). Instead, we‚Äôll aim to have it in a <code>wordpress</code> folder.</p>
<p>For this we‚Äôll need a tool called <a href="https://github.com/fancyguy/webroot-installer">webroot-installer</a>. It‚Äôll let us pull wordpress out of the vendor folder and into a folder of our choice. Composer will take care of downloading it and its configuration will be stored in the <code>composer.json</code> file. This requires 3 changes to the file:</p>
<ol>
<li>Listing webroot-installer as a dependency of the project</li>
<li>Marking WordPress package to be handled by webroot-installer</li>
<li>Configuring webroot-installer to let it know where to put WordPress</li>
</ol>
<div>
<pre>{
  "repositories":[{
    "type": "package",
    "package": {
      "name": "wordpress",
      "version": "4.7.2",
      "type": "webroot",
      "dist": {
        "type": "zip",
        "url": "https://github.com/WordPress/WordPress/archive/4.7.2.zip"
      }
    }
  }],
  "require": {
    "wordpress":"4.7.2",
    "fancyguy/webroot-installer": "1.0.0"
  },
  "extra": {
    "webroot-dir": "wordpress",
    "webroot-package": "wordpress"
  }
}
</pre>
</div>
<p>Let‚Äôs not forget to setup the <code>.gitignore</code> file to blacklist <code>wordpress</code> and <code>vendor</code> (aim is to keep things tidy, after all). Here we go, we now have a repository for a WordPress project clean of WordPress code. Except given WordPress architecture, the code for plugins/themes resides in the <code>wp-content</code> folder‚Ä¶ Which is into the <code>wordpress</code> folder‚Ä¶ Which we just kicked out of our repository‚Ä¶ Echec.</p>
<h2><a href="#running-wordpress-with-an-external-wp-content" name="user-content-running-wordpress-with-an-external-wp-content"></a>Running <code>wordpress</code> with an external <code>wp-content</code></h2>
<p>Fortunately, the <code>wp-content</code> folder used by WordPress doesn‚Äôt need to be inside the <code>wordpress</code> folder. With a couple of constants, we can configure WordPress to run with the following project structure. This will allow to keep <code>wp-content</code> in the repository, holding our code and exclude <code>wordpress</code> from the repository (as well as other 3rd party plugins/themes) via the <code>.gitignore</code>.</p>
<div>
<pre> - wordpress-project
 |-- wordpress
 |-- wp-content
 |-- composer.json
 |-- composer.lock
 |-- wp-config.php
 |-- index.php
</pre>
</div>
<p>The <code>index.php</code> file is a copy of WordPress‚Äô one, with an update to the path for loading WordPress. It needs to account for the <code>wordpress</code> folder now.</p>
<div>
<pre>require( dirname( __FILE__ ) . '/wordpress/wp-blog-header.php' );
</pre>
</div>
<p>The rest of the setup is setting up 3 constants so WordPress knows it‚Äôs in a separate folder, where the <code>wp-content</code> folder actually is and which URL it has when serving it.</p>
<div>
<pre>define( 'WP_CONTENT_DIR', dirname(__FILE__) . '/wp-content');
define('WP_CONTENT_URL', 'http://PROJECT_URL/wp-content');
define('WP_SITEURL', 'http://PROJECT_URL/wordpress');
</pre>
</div>
<p>With these set, WordPress will run with its <code>wp-content</code> folder sitting next to it and the repository is now tidy. Now let‚Äôs see how we can use Composer to download WordPress plugins &#x26; themes. It‚Äôd be a shame to have to do that by hand while we have a dependency manager.</p>
<h2><a href="#installing-wordpress-plugins-with-composer" name="user-content-installing-wordpress-plugins-with-composer"></a>Installing WordPress plugins with Composer</h2>
<p>Like WordPress, it‚Äôs plugins and themes usually aren‚Äôt available on <a href="https://packagist.org/">Packagist</a>. Adding a new repository for each like we did for WordPress isn‚Äôt very manageable either. Fortunately, there‚Äôs a separate Composer repository, called <a href="https://wpackagist.org">WPackagist</a> which provides WordPress plugins &#x26; themes.</p>
<p>You‚Äôll need to add the repository to the <code>composer.json</code> file, and then the WPackagist website will give you the JSON bit to insert in the <code>require</code> section for the plugin/theme you want to download. You can search the plugins directly there, or keep looking them up on the WordPress site and just go to WPackagist to find the JSON snippet.</p>
<div>
<pre>{
  "type":"composer",
  "url":"https://wpackagist.org"
}
</pre>
</div>
<p>That‚Äôs it. This set up lets you have a repository with only the files you write, leaving the downloading of external code to Composer. There‚Äôs still a bit of <code>.gitignore</code> management to do to exclude 3rd party themes &#x26; plugins, but that‚Äôs not too terrible. <a href="https://getcomposer.org/doc/05-repositories.md#path">Path repositories</a> might help get your code live outside <code>wp-content</code> entirely, which would allow an easy blacklisting of the entire <code>wp-content</code> folder. Maybe I‚Äôll give it a go someday, for now this setup works well enough for my needs.</p>
]]></description>
		<guid ispermalink="false">/?p=265</guid>
		</item>
	</atom:link></channel>
</rss>
</body></html>