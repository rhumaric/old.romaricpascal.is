
<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .u-troisCoups body>* {
            visibility: hidden;
        }
    </style>
    <script>
        (function (window) {
            if (document.documentElement.classList) {
                window.troisCoups = {
                    reveal: function () {
                        document.documentElement.classList.remove('u-troisCoups');
                    }
                };


                document.documentElement.classList.add('u-troisCoups');
                setTimeout(window.troisCoups.reveal, 1500);
            }
        })(window);
    </script>

    <link rel="stylesheet" href="/wp-content/themes/romaricpascal.is/style.css">
    <link rel="alternate" type="application/rss+xml" title="Romaric Pascal | Lettering &amp; web development" href="/feed">

    <title>   Discovering Web Workers | Romaric Pascal</title>
    <meta name="description" content="Lettering &amp; web development">

    <link rel="apple-touch-icon" sizes="180x180" href="/wp-content/themes/romaricpascal.is/assets/images/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/wp-content/themes/romaricpascal.is/assets/images/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/wp-content/themes/romaricpascal.is/assets/images/favicons/favicon-16x16.png">
<link rel="manifest" href="/wp-content/themes/romaricpascal.is/assets/images/favicons/manifest.json">
<link rel="mask-icon" href="/wp-content/themes/romaricpascal.is/assets/images/favicons/safari-pinned-tab.svg" color="#022950">
<link rel="shortcut icon" href="/wp-content/themes/romaricpascal.is/assets/images/favicons/favicon.ico">
<meta name="msapplication-config" content="/wp-content/themes/romaricpascal.is/assets/images/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffc744">
    <!-- FB OpenGraph info -->
        <meta prefix="og:http://ogp.me/ns#" property="og:url" content="/writing-about/discovering-web-workers/">
        <meta prefix="og:http://ogp.me/ns#" property="og:title" content="   Discovering Web Workers | Romaric Pascal">
    <meta prefix="og:http://ogp.me/ns#" property="og:description" content="Lettering &amp; web development">
    <meta prefix="og:http://ogp.me/ns#" property="og:image" content="/wp-content/themes/romaricpascal.is/assets/images/rp_with-padding_yellowbg_480.png">

    <!-- Twitter cards -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@romaricpascal" />
    <meta name="twitter:title" content="   Discovering Web Workers | Romaric Pascal" />
    <meta name="twitter:description" content="Lettering &amp; web development" />
    <meta name="twitter:image" content="/wp-content/themes/romaricpascal.is/assets/images/rp_with-padding_yellowbg_480.png" />

    <link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Romaric Pascal &raquo; Discovering Web Workers Comments Feed" href="/writing-about/discovering-web-workers/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/romaricpascal.is\/wordpress\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.8.13"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b!==c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='contact-form-7-css'  href='/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.9' type='text/css' media='all' />
<script type='text/javascript' src='/wordpress/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wordpress/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<link rel="canonical" href="/writing-about/discovering-web-workers/" />
  </head>
  <body class="post-template-default single single-post postid-296 single-format-standard flexbug3Wrapper">
    <header id="#header" class="rp-Header">
        <a class="rp-Logo" href="" title="Home">
    <img src="/wp-content/themes/romaricpascal.is/assets/images/rp-letters_144.png" alt="R-P monogram">
</a>
<nav class="rp-BreadcrumbNav">
    <div class="rp-CollapsedItemsMenu">
        <a class="rp-BreadcrumbLink rp-CollapsedItemsMenuToggle js-toggle" data-toggle-group="overlays" data-toggle-target=".rp-CollapsedItems">
            <span class="rp-BreadcrumbLinkSeparator"></span>
            <span class="rp-BreadcrumbLink__title">...</span>
        </a>
        <div class="rp-CollapsedItems js-outsideToggle"></div>
    </div>
    <div class="rp-BreadcrumbNavItems js-collapsible">
				<a href="/writing-about/" class="rp-BreadcrumbLink">
			<span class="rp-BreadcrumbLinkSeparator"></span>
			<span class="rp-BreadcrumbLink__title">Posts</span>
		</a>
		    </div>
</nav>      <nav class="rp-MainNav">
        <a class="t-hidden-visually" tabindex="1" href="#content">Skip to content</a>
        <a href="#main-nav" class="js-toggle" data-toggle-group="overlays" data-toggle-target=".rp-MenuContainer">Menu</a>
        <div class="rp-MenuContainer js-outsideToggle" id="main-nav">
        <a class="rp-NavLogo" href="" title="Home">
            <img src="/wp-content/themes/romaricpascal.is/assets/images/rp-knockout_shade_144.png" alt="Home">
        </a>
        <div class="menu-site-navigation-container"><ul id="menu-site-navigation" class="rp-Menu rp-Header__menuI"><li id="menu-item-936" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home menu-item-936"><a href="/">Home</a></li>
<li id="menu-item-960" class="menu-item menu-item-type-post_type_archive menu-item-object-project menu-item-has-children menu-item-960"><a href="/proud-of/">Portfolio</a>
<ul  class="sub-menu">
	<li id="menu-item-942" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-942"><a href="/proud-of/logo-brand-designs">Logo &#038; Brand</a></li>
	<li id="menu-item-954" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-954"><a href="/proud-of/tshirts-merch-designs/">T-shirts &#038; merch</a></li>
	<li id="menu-item-957" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-957"><a href="/proud-of/print-illustration-designs">Print &#038; illustration</a></li>
</ul>
</li>
<li id="menu-item-964" class="menu-item menu-item-type-post_type_archive menu-item-object-artwork menu-item-964"><a href="/drawing-letters/">Artworks</a></li>
<li id="menu-item-935" class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-935"><a href="/writing-about/">Blog</a></li>
<li id="menu-item-933" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-933"><a href="/happy-to-chat/">Contact</a></li>
<li id="menu-item-1022" class="menu-item menu-item-type-taxonomy menu-item-object-craft current-post-ancestor current-menu-parent current-post-parent menu-item-1022"><a href="/writing-about/craft/web/">Web</a></li>
<li id="menu-item-934" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-934"><a target="_blank" href="/selling-nice-stuff/">Shop</a></li>
</ul></div>        <a class="rp-MenuToggle js-toggle" href="#" data-toggle-group="overlays" data-toggle-target=".rp-MenuContainer">Close menu</a>
        <small class="rp-Legal l-Container">© Romaric Pascal (trading name of <a href="https://beta.companieshouse.gov.uk/company/08544032">Rhumaric Ltd</a>)</small>
        </div>
      </nav>
    </header>
    <div class="rp-Viewport l-vertCentered u-mh-100vh">


<article class="rp-Content">
  <header class="rp-HeaderWithSubhead u-mb-2">
    <h1 class="rp-HeaderWithSubhead__heading">
        Discovering Web Workers    </h1>
    <p><time datetime="2013-07-22T08:37:06+00:00">22 Jul 2013</time> — An article about: <a href="/writing-about/craft/web/" rel="tag">Web</a> - <a href="/writing-about/category/uncategorized/" rel="category tag">Uncategorized</a></p>
  </header>
  <main>
    <p>In a web page, Javascript is single threaded. It&#8217;s all good if your application runs small operations, that return quickly. However, if you need to do heavier, longer computations, your user interface could get less responsive, harming your user&#8217;s experience. While the Javascript thread is busy processing your data, it cannot handle the users&#8217;s clicks, or update the elements on the page. That&#8217;s where Web Workers come save the day. They let you run code in a separate thread, leaving the Javascript in your page free to handle the user interactions.</p>
<p>Let&#8217;s start with a <a href="/wp-content/uploads/demo/discovering-web-workers/">quick example</a>:</p>
<ul>
<li>two animated squares, one using JS, the other using CSS (I&#8217;ll let you guess which is which ;))</li>
<li>buttons to run a &#8220;big computation&#8221; (well&#8230; just a big loop in fact), either in the page thread or using a web worker</li>
</ul>
<p><iframe src="/wp-content/uploads/demo/discovering-web-workers/" height="350px" style="width: 100%; height: auto;"></iframe></p>
<p>When the page&#8217;s running the computation, the JS animated square stops spinning (and in some browsers even the CSS one). The Javascript thread is stuck in the &#8220;big computation&#8221;, nothing else will happen until it is over (even just changing the button&#8217;s label). Using a Worker, the square keep spining, buttons handle clicks instantly&#8230;</p>
<p>Delegate the big computation to Web Workers, update the screen when it sends you the results, you keep your UI responsive. Sounds perfect to crunch big numbers or search in big arrays of data on the client.</p>
<h2>Where I can haz Web Worker</h2>
<p>Before looking deeper into how Web Worker works, let&#8217;s have a look at <a href="http://caniuse.com/webworkers/embed/">which browsers support them</a>. On desktop, you&#8217;ll need to find an alternative if you need to support IE before its 10th version. On mobile, it&#8217;s android&#8217;s default browser that causes problem.</p>
<h2>So&#8230; how does it work ?</h2>
<p>The Web Worker introduces the <code>Worker</code> class, which allows you to create workers. You just need to provide the path to the Javascript file containing the code the worker runs. If you prefer to <a href="https://stackoverflow.com/questions/10343913/how-to-create-a-web-worker-from-a-string/10372280#10372280">use a String rather than an external script</a>, you&#8217;ll have to be a bit sneaky but it&#8217;s doable.</p>
<div class="highlight">
<pre>// On the page
var worker = new Worker('js/my-worker.js');
</pre>
</div>
<p>Workers and your page communicate using messages. You use <code>postMessage()</code> to send a message to the other side and listen to <code>message</code> events to act upon the data you receive. Note that the object you send in the message are copied to the other side. Workers and your page do not share any objects.</p>
<div class="highlight">
<pre>// On the page
worker.addEventListener('message', function (event) {
  // Process the worker's result here (eg. update UI)
  display(event.data);
});
worker.addEventListener('error', function () {
  // Process the worker's error there
});
worker.postMessage(mydata);

// In the worker
worker.addEventListener('message', function (event) {
  // Do the heavy lifting here...
  var result = crunchNumbers(event.data);
  // ... And send the result back to the page
  postMessage(result);
}
</pre>
</div>
<p>On the page side, the worker can also dispatch a &#8216;error&#8217; message in case something wrong happened during its execution.</p>
<p>When you&#8217;re done using a worker, you can end its execution using the <code>terminate</code> method on the page&#8217;s side. Pretty handy to stop a worker polling a web page at regular intervals.</p>
<h2>Inside the worker</h2>
<p>Workers are completely separated from your page. They don&#8217;t share any data with it and have a restricted list of function/objects in their global scope.</p>
<p>Starting with the bad news, you&#8217;ve got no access to the DOM in your worker, nor to <code>window</code> or <code>document</code>. And maybe the one you&#8217;ll miss most, no <code>console</code> inside the worker to do logging (using <code>postMessage</code> and a listener that logs every message received on the page&#8217;s side makes a quick replacement).</p>
<p>Looking at the bright side of things, <code>XMLHTTPRequest</code> is available. This means you can make query to your service, maybe to pull some data at regular intervals. The worker&#8217;s also implement the <code>WindowTimers</code> interface, giving you access to the <code>setTimeout</code>/<code>setInterval</code> methods (and their <code>clearTimeout</code>/<code>clearInterval</code> counterparts).</p>
<p>You also have access to the <code>navigator</code>, a read-only version of <code>location</code>, and <code>online</code>/<code>offline</code> events. <code>btoa</code> and <code>atob</code> are there too, if you need to do base 64 encoding/decoding.</p>
<h2>Sharing code with your worker</h2>
<p>You might want to reuse some functions or classes from the code running on your page, maybe even use some 3rd party library. Good news here, inside the worker you can load external scripts using the <code>importScripts()</code> function. The path of your scripts must be relative to the worker&#8217;s script (I tested quickly but data URI seemed to work too) and comply to the same origin policy.</p>
<p>If you&#8217;re planning to import a 3rd party library, remember the API available inside the worker is limited. If the library you need uses <code>window</code> or <code>document</code>, you&#8217;ll probably need to extend/patch it (hopefully the first option ;)), or find another one.</p>
<h2>Wrapping it up!</h2>
<p>Web Workers are a bit tricky to debug with no access to `console`, as well as the dev tools having trouble putting breakpoints in the code of the workers (in Firefox and Chrome, at least, unless I missed an experimental feature). The lack of support in IE9 and below, as well as the native android browser also requires you to have a fallback (delegating the big work to the server, or maybe processing your data in smaller chunks). They provide a powerfull feature, though, that allows you to keep your UI responsive while handling big computations in the browser, saving you some requests to the server (or maybe you&#8217;re offline and can&#8217;t make request to your server). <strong>Great to be able to do more on the client side, don&#8217;t you think?</strong></p>
  </main>
  <aside>

  </aside>
  <nav class="rp-PrevNextNav">
		<a class="rp-PrevNextLink rp-PrevNextLink-prev rp-PrevNextNav__previous" 
	   href="/writing-about/what-was-the-page-number-again/"
	   rel="prev"
	   	   accesskey="j"
	   data-key="left"
			   title="What was the page number again?">
	   	title	</a>
		<a class="rp-PrevNextLink rp-PrevNextLink-next rp-PrevNextNav__next" 
	   href="/writing-about/renewing-the-grunt-livereload-magic/"
	   rel="next"
	   		accesskey="k"
	   	data-key="right"
			   title="Renewing the grunt &amp; livereload magic">
	   	title	</a>
</nav>
</article>

  </div>
  <script type='text/javascript'>
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/romaricpascal.is\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}}};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.9'></script>
  <script defer src="/wp-content/themes/romaricpascal.is/main.js"></script>
</body>
