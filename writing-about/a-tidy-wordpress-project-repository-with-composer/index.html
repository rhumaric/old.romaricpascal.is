<!doctype html><html lang="en-US"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .u-troisCoups body>* {
            visibility: hidden;
        }
    </style>
    <script>
        (function (window) {
            if (document.documentElement.classList) {
                window.troisCoups = {
                    reveal: function () {
                        document.documentElement.classList.remove('u-troisCoups');
                    }
                };


                document.documentElement.classList.add('u-troisCoups');
                setTimeout(window.troisCoups.reveal, 1500);
            }
        })(window);
    </script>

    <link rel="stylesheet" href="/wp-content/themes/romaricpascal.is/style.css">
    <link rel="alternate" type="application/rss+xml" title="Romaric Pascal | Lettering &#x26; web development" href="/feed">

    <title>   A tidy WordPress project repository with Composer | Romaric Pascal</title>
    <meta name="description" content="Lettering &#x26; web development">

    <link rel="apple-touch-icon" sizes="180x180" href="/wp-content/themes/romaricpascal.is/assets/images/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/wp-content/themes/romaricpascal.is/assets/images/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/wp-content/themes/romaricpascal.is/assets/images/favicons/favicon-16x16.png">
<link rel="manifest" href="/wp-content/themes/romaricpascal.is/assets/images/favicons/manifest.json">
<link rel="mask-icon" href="/wp-content/themes/romaricpascal.is/assets/images/favicons/safari-pinned-tab.svg" color="#022950">
<link rel="shortcut icon" href="/wp-content/themes/romaricpascal.is/assets/images/favicons/favicon.ico">
<meta name="msapplication-config" content="/wp-content/themes/romaricpascal.is/assets/images/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffc744">
    <!-- FB OpenGraph info -->
        <meta prefix="og:http://ogp.me/ns#" property="og:url" content="/writing-about/a-tidy-wordpress-project-repository-with-composer/">
        <meta prefix="og:http://ogp.me/ns#" property="og:title" content="   A tidy WordPress project repository with Composer | Romaric Pascal">
    <meta prefix="og:http://ogp.me/ns#" property="og:description" content="Lettering &#x26; web development">
    <meta prefix="og:http://ogp.me/ns#" property="og:image" content="/wp-content/themes/romaricpascal.is/assets/images/rp_with-padding_yellowbg_480.png">

    <!-- Twitter cards -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@romaricpascal">
    <meta name="twitter:title" content="   A tidy WordPress project repository with Composer | Romaric Pascal">
    <meta name="twitter:description" content="Lettering &#x26; web development">
    <meta name="twitter:image" content="/wp-content/themes/romaricpascal.is/assets/images/rp_with-padding_yellowbg_480.png">

    <link rel="dns-prefetch" href="//s.w.org">
<link rel="alternate" type="application/rss+xml" title="Romaric Pascal » A tidy WordPress project repository with Composer Comments Feed" href="/writing-about/a-tidy-wordpress-project-repository-with-composer/feed/">
		
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>



<link rel="canonical" href="/writing-about/a-tidy-wordpress-project-repository-with-composer/">
  </head>
  <body class="post-template-default single single-post postid-265 single-format-standard flexbug3Wrapper">
    <header id="#header" class="rp-Header">
        <a class="rp-Logo" href="" title="Home">
    <img src="/wp-content/themes/romaricpascal.is/assets/images/rp-letters_144.png" alt="R-P monogram">
</a>
<nav class="rp-BreadcrumbNav">
    <div class="rp-CollapsedItemsMenu">
        <a class="rp-BreadcrumbLink rp-CollapsedItemsMenuToggle js-toggle" data-toggle-group="overlays" data-toggle-target=".rp-CollapsedItems">
            <span class="rp-BreadcrumbLinkSeparator"></span>
            <span class="rp-BreadcrumbLink__title">...</span>
        </a>
        <div class="rp-CollapsedItems js-outsideToggle"></div>
    </div>
    <div class="rp-BreadcrumbNavItems js-collapsible">
				<a href="/writing-about/" class="rp-BreadcrumbLink">
			<span class="rp-BreadcrumbLinkSeparator"></span>
			<span class="rp-BreadcrumbLink__title">Posts</span>
		</a>
		    </div>
</nav>      <nav class="rp-MainNav">
        <a class="t-hidden-visually" tabindex="1" href="#content">Skip to content</a>
        <a href="#main-nav" class="js-toggle" data-toggle-group="overlays" data-toggle-target=".rp-MenuContainer">Menu</a>
        <div class="rp-MenuContainer js-outsideToggle" id="main-nav">
        <a class="rp-NavLogo" href="" title="Home">
            <img src="/wp-content/themes/romaricpascal.is/assets/images/rp-knockout_shade_144.png" alt="Home">
        </a>
        <div class="menu-site-navigation-container"><ul id="menu-site-navigation" class="rp-Menu rp-Header__menuI"><li id="menu-item-936" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home menu-item-936"><a href="/">Home</a></li>
<li id="menu-item-960" class="menu-item menu-item-type-post_type_archive menu-item-object-project menu-item-has-children menu-item-960"><a href="/proud-of/">Portfolio</a>
<ul class="sub-menu">
	<li id="menu-item-942" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-942"><a href="/proud-of/logo-brand-designs">Logo &#x26; Brand</a></li>
	<li id="menu-item-954" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-954"><a href="/proud-of/tshirts-merch-designs/">T-shirts &#x26; merch</a></li>
	<li id="menu-item-957" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-957"><a href="/proud-of/print-illustration-designs">Print &#x26; illustration</a></li>
</ul>
</li>
<li id="menu-item-964" class="menu-item menu-item-type-post_type_archive menu-item-object-artwork menu-item-964"><a href="/drawing-letters/">Artworks</a></li>
<li id="menu-item-935" class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-935"><a href="/writing-about/">Blog</a></li>
<li id="menu-item-933" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-933"><a href="/happy-to-chat/">Contact</a></li>
<li id="menu-item-1022" class="menu-item menu-item-type-taxonomy menu-item-object-craft current-post-ancestor current-menu-parent current-post-parent menu-item-1022"><a href="/writing-about/craft/web/">Web</a></li>
<li id="menu-item-934" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-934"><a target="_blank" href="/selling-nice-stuff/">Shop</a></li>
</ul></div>        <a class="rp-MenuToggle js-toggle" href="#" data-toggle-group="overlays" data-toggle-target=".rp-MenuContainer">Close menu</a>
        <small class="rp-Legal l-Container">© Romaric Pascal (trading name of <a href="https://beta.companieshouse.gov.uk/company/08544032">Rhumaric Ltd</a>)</small>
        </div>
      </nav>
    </header>
    <div class="rp-Viewport l-vertCentered u-mh-100vh">


<article class="rp-Content">
  <header class="rp-HeaderWithSubhead u-mb-2">
    <h1 class="rp-HeaderWithSubhead__heading">
        A tidy WordPress project repository with Composer    </h1>
    <p><time datetime="2017-02-08T15:47:00+00:00">08 Feb 2017</time> — An article about: <a href="/writing-about/craft/web/" rel="tag">Web</a> - <a href="/writing-about/category/php/composer/" rel="category tag">Composer</a> - <a href="/writing-about/category/php/" rel="category tag">PHP</a> - <a href="/writing-about/category/php/wordpress/" rel="category tag">Wordpress</a></p>
  </header>
  <main>
    <p>A WordPress project usually involves creating custom theme(s) and/or plugin(s) and adding them to a WordPress install, along with maybe a few 3rd party plugins or a parent theme. Having WordPress and these 3rd party elements in the repository make it unnecessarily big.</p>
<p>An alternative to storing the 3rd party code your project use into its repository is to use a dependency manager. Dependency managers are tools that let you store a list of these 3rd party libraries in your repository, and will take charge of downloading them and installing them in your project. Which is what <a href="https://getcomposer.org/">Composer</a> does. Let’s see how we can use it to keep our repository tidy.</p>
<h2><a href="#composer-in-a-few-lines" name="user-content-composer-in-a-few-lines"></a>Composer in a few lines</h2>
<p>First step is obviously to install Composer on your machine. <a href="https://getcomposer.org/doc/00-intro.md">The tool’s getting started guide</a> will guide you through these steps.</p>
<p>Composer works with a <code>composer.json</code> file that lists the dependencies of your project. The most common type of dependencies are 3rd party libraries. Composer will fetch them from its default package repository <a href="https://packagist.org/">Packagist</a> (or other repositories listed in the <code>composer.json</code> file). Additionaly, you can specify that your project needs specific PHP extensions to work properly or features from a minimum PHP version. This helps making sure all necessary things are present for your project to work properly.</p>
<p>The <code>composer install</code> command then installs all the listed dependencies, downloading them as needed.</p>
<h2><a href="#downloading-wordpress-with-composer" name="user-content-downloading-wordpress-with-composer"></a>Downloading WordPress with Composer</h2>
<p>With composer ready, let’s set it up to download WordPress. Unfortunately, WordPress doesn’t have any package stored on <a href="https://packagist.org/">Packagist</a>. That doesn’t mean Composer can’t work with it, though. Composer can <a href="https://getcomposer.org/doc/05-repositories.md">use other repositories</a> and is perfectly capable to download a zip file from Github, for example. The corresponding <code>composer.json</code> is the following.</p>
<div>
<pre>{
  "repositories":[{
    "type": "package",
    "package": {
      "name": "wordpress",
      "version": "4.7.2",
      "dist": {
        "type": "zip",
        "url": "https://github.com/WordPress/WordPress/archive/4.7.2.zip"
      }
    }
  }],
  "require": {
    "wordpress":"4.7.2"
  }
}
</pre>
</div>
<p>Run <code>composer install</code> and WordPress will be downloaded… in the <code>vendor/wordpress</code> folder. Not quite where you’d want it…</p>
<h2><a href="#downloading-wordpress-in-a-handier-location" name="user-content-downloading-wordpress-in-a-handier-location"></a>Downloading WordPress in a handier location</h2>
<p>A more common folder structure would be having WordPress’ files at the root of the project. This structure makes it a hassle when it comes to manage files blacklisted in <code>.gitignore</code> (or <code>.hgignore</code>, or <code>.&#x3C;whatever>ignore</code>). Instead, we’ll aim to have it in a <code>wordpress</code> folder.</p>
<p>For this we’ll need a tool called <a href="https://github.com/fancyguy/webroot-installer">webroot-installer</a>. It’ll let us pull wordpress out of the vendor folder and into a folder of our choice. Composer will take care of downloading it and its configuration will be stored in the <code>composer.json</code> file. This requires 3 changes to the file:</p>
<ol>
<li>Listing webroot-installer as a dependency of the project</li>
<li>Marking WordPress package to be handled by webroot-installer</li>
<li>Configuring webroot-installer to let it know where to put WordPress</li>
</ol>
<div>
<pre>{
  "repositories":[{
    "type": "package",
    "package": {
      "name": "wordpress",
      "version": "4.7.2",
      "type": "webroot",
      "dist": {
        "type": "zip",
        "url": "https://github.com/WordPress/WordPress/archive/4.7.2.zip"
      }
    }
  }],
  "require": {
    "wordpress":"4.7.2",
    "fancyguy/webroot-installer": "1.0.0"
  },
  "extra": {
    "webroot-dir": "wordpress",
    "webroot-package": "wordpress"
  }
}
</pre>
</div>
<p>Let’s not forget to setup the <code>.gitignore</code> file to blacklist <code>wordpress</code> and <code>vendor</code> (aim is to keep things tidy, after all). Here we go, we now have a repository for a WordPress project clean of WordPress code. Except given WordPress architecture, the code for plugins/themes resides in the <code>wp-content</code> folder… Which is into the <code>wordpress</code> folder… Which we just kicked out of our repository… Echec.</p>
<h2><a href="#running-wordpress-with-an-external-wp-content" name="user-content-running-wordpress-with-an-external-wp-content"></a>Running <code>wordpress</code> with an external <code>wp-content</code></h2>
<p>Fortunately, the <code>wp-content</code> folder used by WordPress doesn’t need to be inside the <code>wordpress</code> folder. With a couple of constants, we can configure WordPress to run with the following project structure. This will allow to keep <code>wp-content</code> in the repository, holding our code and exclude <code>wordpress</code> from the repository (as well as other 3rd party plugins/themes) via the <code>.gitignore</code>.</p>
<div>
<pre> - wordpress-project
 |-- wordpress
 |-- wp-content
 |-- composer.json
 |-- composer.lock
 |-- wp-config.php
 |-- index.php
</pre>
</div>
<p>The <code>index.php</code> file is a copy of WordPress’ one, with an update to the path for loading WordPress. It needs to account for the <code>wordpress</code> folder now.</p>
<div>
<pre>require( dirname( __FILE__ ) . '/wordpress/wp-blog-header.php' );
</pre>
</div>
<p>The rest of the setup is setting up 3 constants so WordPress knows it’s in a separate folder, where the <code>wp-content</code> folder actually is and which URL it has when serving it.</p>
<div>
<pre>define( 'WP_CONTENT_DIR', dirname(__FILE__) . '/wp-content');
define('WP_CONTENT_URL', 'http://PROJECT_URL/wp-content');
define('WP_SITEURL', 'http://PROJECT_URL/wordpress');
</pre>
</div>
<p>With these set, WordPress will run with its <code>wp-content</code> folder sitting next to it and the repository is now tidy. Now let’s see how we can use Composer to download WordPress plugins &#x26; themes. It’d be a shame to have to do that by hand while we have a dependency manager.</p>
<h2><a href="#installing-wordpress-plugins-with-composer" name="user-content-installing-wordpress-plugins-with-composer"></a>Installing WordPress plugins with Composer</h2>
<p>Like WordPress, it’s plugins and themes usually aren’t available on <a href="https://packagist.org/">Packagist</a>. Adding a new repository for each like we did for WordPress isn’t very manageable either. Fortunately, there’s a separate Composer repository, called <a href="https://wpackagist.org">WPackagist</a> which provides WordPress plugins &#x26; themes.</p>
<p>You’ll need to add the repository to the <code>composer.json</code> file, and then the WPackagist website will give you the JSON bit to insert in the <code>require</code> section for the plugin/theme you want to download. You can search the plugins directly there, or keep looking them up on the WordPress site and just go to WPackagist to find the JSON snippet.</p>
<div>
<pre>{
  "type":"composer",
  "url":"https://wpackagist.org"
}
</pre>
</div>
<p>That’s it. This set up lets you have a repository with only the files you write, leaving the downloading of external code to Composer. There’s still a bit of <code>.gitignore</code> management to do to exclude 3rd party themes &#x26; plugins, but that’s not too terrible. <a href="https://getcomposer.org/doc/05-repositories.md#path">Path repositories</a> might help get your code live outside <code>wp-content</code> entirely, which would allow an easy blacklisting of the entire <code>wp-content</code> folder. Maybe I’ll give it a go someday, for now this setup works well enough for my needs.</p>
  </main>
  <aside>

  </aside>
  <nav class="rp-PrevNextNav">
		<a class="rp-PrevNextLink rp-PrevNextLink-prev rp-PrevNextNav__previous" href="/writing-about/case-study-a-logo-for-taskfight/" rel="prev" accesskey="j" data-key="left" title="Case study: A logo for TaskFight">
	   	title	</a>
		<a class="rp-PrevNextLink rp-PrevNextLink-next rp-PrevNextNav__next" href="/writing-about/a-few-thoughts-for-my-lettering-practices/" rel="next" accesskey="k" data-key="right" title="A few thoughts for my lettering practices">
	   	title	</a>
</nav>
</article>

  </div>
  

  <script defer src="/wp-content/themes/romaricpascal.is/main.js"></script>

</body></html>